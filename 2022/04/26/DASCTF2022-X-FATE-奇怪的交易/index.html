<!DOCTYPE html>
<html lang="en">
    <!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1">
  <meta name="color-scheme" content="light dark">
  
  <title>DASCTF2022 X FATE-奇怪的交易 - P.Z&#39;s Blog</title>
  
    <link rel="shortcut icon" href="/favicon.png">
  
  

  
<link rel="stylesheet" href="/css/var.css">

  
<link rel="stylesheet" href="/css/main.css">

  
<link rel="stylesheet" href="/css/typography.css">

  
<link rel="stylesheet" href="/css/code-highlighting.css">

  
<link rel="stylesheet" href="/css/components.css">

  
<link rel="stylesheet" href="/css/nav.css">

  
<link rel="stylesheet" href="/css/paginator.css">

  
<link rel="stylesheet" href="/css/footer.css">

  
<link rel="stylesheet" href="/css/post-list.css">

  
<link rel="stylesheet" href="/css/waline.css">

  
  
  
<link rel="stylesheet" href="/css/post.css">

  

  
    
<script src="https://cdn.jsdelivr.net/npm/js-cookie@rc/dist/js.cookie.min.js"></script>
 
  

    <script src='//cdn.jsdelivr.net/npm/@waline/client/dist/Waline.min.js'></script>

<meta name="generator" content="Hexo 6.0.0"></head>

<!-- //unpkg.com/@waline/client -->
<!--  -->
    <body data-color-scheme="auto">
        <nav id="theme-nav">
    <div class="inner">
        <a class="title" href="/">P.Z&#39;s Blog</a>
        <div class="nav-arrow"></div>
        <div class="nav-items">
            <a class="nav-item nav-item-home" href="/">Home</a>
            
            
            <a class="nav-item" href="/Diary/Diary">Diary</a>
            
            
            
            <a class="nav-item" href="/Friends/Friends">Friends</a>
            
            
            
            <a class="nav-item" href="/CTF/CTF">CTF</a>
            
            
            
            <a class="nav-item" href="/Book/Book">Book</a>
            
            
            
            <a class="nav-item" href="/Sundry/Sundry">Sundry</a>
            
            
            
            <a class="nav-item nav-item-github nav-item-icon" href="https://github.com/PoZeep" target="_blank">&nbsp;</a>
            
            
            
            <a class="nav-item nav-item-patreon nav-item-icon" href="https://space.bilibili.com/39892350" target="_blank">&nbsp;</a>
            
            
        </div>
    </div>
</nav>
        <article class="post">
    <div class="meta">
        
        <div class="date" id="date">
            
            
            
            
            <span>April</span>
            
            
            
            
            
            
            
            
            
            <span>26,</span>
            <span>2022</span>
        </div>
        

        <h2 class="title">DASCTF2022 X FATE-奇怪的交易</h2>
    </div>

    <div class="divider"></div>

    <div class="content">
        <h1 id="0x00-日常查壳"><a href="#0x00-日常查壳" class="headerlink" title="0x00 日常查壳"></a>0x00 日常查壳</h1><p>难得查到壳，不过upx直接-d解壳即可</p>
<p><img src="/2022/04/26/DASCTF2022-X-FATE-%E5%A5%87%E6%80%AA%E7%9A%84%E4%BA%A4%E6%98%93/image-20220426164135626.png" alt="image-20220426164135626"></p>
<h1 id="0x01-恢复python"><a href="#0x01-恢复python" class="headerlink" title="0x01 恢复python"></a>0x01 恢复python</h1><p>拉进ida开逆会发现是<strong>打包成ELF的python文件</strong>，可以查询下PYI_PROCNAME</p>
<p><img src="/2022/04/26/DASCTF2022-X-FATE-%E5%A5%87%E6%80%AA%E7%9A%84%E4%BA%A4%E6%98%93/image-20220425232353888.png" alt="image-20220425232353888"></p>
<p>直接拉到linux下解包，然后再用pyinstxtractor解包</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">objcopy --dump-section pydata=werid.dump werid</span><br><span class="line">python pyinstxtractor.py werid.dump</span><br></pre></td></tr></table></figure>

<p>这样直出解包文件，再把struct.pyc的头十六个字节赋到 奇怪的交易.pyc 的头十六位</p>
<p><img src="/2022/04/26/DASCTF2022-X-FATE-%E5%A5%87%E6%80%AA%E7%9A%84%E4%BA%A4%E6%98%93/image-20220425233055033.png" alt="image-20220425233055033"></p>
<p>直接pycdc一把梭了，实际上我淦了一下午python…（已经麻了，算长点python汇编经验</p>
<p><img src="/2022/04/26/DASCTF2022-X-FATE-%E5%A5%87%E6%80%AA%E7%9A%84%E4%BA%A4%E6%98%93/image-20220425233221576.png" alt="image-20220425233221576"></p>
<h1 id="0x02-GetFlag"><a href="#0x02-GetFlag" class="headerlink" title="0x02 GetFlag"></a>0x02 GetFlag</h1><p>程序逻辑是，RSA加密，和通过提示不难猜出是TEA系列加密，稍加尝试得知是xxtea（然而我并没有试出来</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdint.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> KEYLEN 4</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DELTA 0x9e3779b9</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LUN 32</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Encrypt</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> * v, <span class="keyword">unsigned</span> <span class="keyword">int</span> * k)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Decrypt</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> * v, <span class="keyword">unsigned</span> <span class="keyword">int</span> * k)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MX (((z&gt;&gt;5^y<span class="meta-string">&lt;&lt;2) + (y&gt;</span>&gt;3^z&lt;&lt;4)) ^ ((sum^y) + (key[(p&amp;3)^e] ^ z)))</span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">btea</span><span class="params">(<span class="keyword">uint32_t</span> *v, <span class="keyword">int</span> n, <span class="keyword">uint32_t</span> <span class="keyword">const</span> key[<span class="number">4</span>])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">uint32_t</span> y, z, sum;</span><br><span class="line">    <span class="keyword">unsigned</span> p, rounds, e;</span><br><span class="line">    <span class="keyword">if</span> (n &gt; <span class="number">1</span>)            <span class="comment">/* Coding Part */</span></span><br><span class="line">    &#123;</span><br><span class="line">        rounds = <span class="number">6</span> + <span class="number">52</span>/n;</span><br><span class="line">        sum = <span class="number">0</span>;</span><br><span class="line">        z = v[n<span class="number">-1</span>];</span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">        &#123;</span><br><span class="line">            sum += DELTA;</span><br><span class="line">            e = (sum &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span>;</span><br><span class="line">            <span class="keyword">for</span> (p=<span class="number">0</span>; p&lt;n<span class="number">-1</span>; p++)</span><br><span class="line">            &#123;</span><br><span class="line">                y = v[p+<span class="number">1</span>];</span><br><span class="line">                z = v[p] += MX;</span><br><span class="line">            &#125;</span><br><span class="line">            y = v[<span class="number">0</span>];</span><br><span class="line">            z = v[n<span class="number">-1</span>] += MX;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> (--rounds);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (n &lt; <span class="number">-1</span>)      <span class="comment">/* Decoding Part */</span></span><br><span class="line">    &#123;</span><br><span class="line">        n = -n;</span><br><span class="line">        rounds = <span class="number">6</span> + <span class="number">52</span>/n;</span><br><span class="line">        sum = rounds*DELTA;</span><br><span class="line">        y = v[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">        &#123;</span><br><span class="line">            e = (sum &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span>;</span><br><span class="line">            <span class="keyword">for</span> (p=n<span class="number">-1</span>; p&gt;<span class="number">0</span>; p--)</span><br><span class="line">            &#123;</span><br><span class="line">                z = v[p<span class="number">-1</span>];</span><br><span class="line">                y = v[p] -= MX;</span><br><span class="line">            &#125;</span><br><span class="line">            z = v[n<span class="number">-1</span>];</span><br><span class="line">            y = v[<span class="number">0</span>] -= MX;</span><br><span class="line">            sum -= DELTA;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> (--rounds);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">uint32_t</span> v[] = &#123; <span class="number">0xD28ED952</span>, <span class="number">1472742623</span>, <span class="number">0xD91BA938</span>, <span class="number">0xF9F3BD2D</span>, <span class="number">0x8EF8E43D</span>, <span class="number">617653972</span>, <span class="number">1474514999</span>, <span class="number">1471783658</span>, <span class="number">1012864704</span>, <span class="number">0xD7821910</span>, <span class="number">993855884</span>, <span class="number">438456717</span>, <span class="number">0xC83555B7</span>, <span class="number">0xE8DFF468</span>, <span class="number">198959101</span>, <span class="number">0xC5B84FEB</span>, <span class="number">0xD9F837C6</span>, <span class="number">613157871</span>, <span class="number">0x8EFA4EDD</span>, <span class="number">97286225</span>, <span class="number">0x8B4B608C</span>, <span class="number">1471645170</span>, <span class="number">0xC0B62792</span>, <span class="number">583597118</span>, <span class="number">0xAAB1C22D</span>, <span class="number">0xBDB9C266</span>, <span class="number">1384330715</span>, <span class="number">0xAE9F9816</span>, <span class="number">0xD1F40B3C</span>, <span class="number">0x8206DDC3</span>, <span class="number">0xC4E0BADC</span>, <span class="number">0xE407BD26</span>, <span class="number">145643141</span>, <span class="number">0x8016C6A5</span>, <span class="number">0xAF4AB9D3</span>, <span class="number">506798154</span>, <span class="number">994590281</span>, <span class="number">0x85082A0B</span>, <span class="number">0xCA0BC95A</span>, <span class="number">0xA7BE567C</span>, <span class="number">1105937096</span>, <span class="number">1789727804</span>, <span class="number">0xDFEFB591</span>, <span class="number">0x93346B38</span>, <span class="number">1162286478</span>, <span class="number">680814033</span>, <span class="number">0xAEE1A7A2</span>, <span class="number">0x80E574AE</span>, <span class="number">0xF154F55F</span>, <span class="number">2121620700</span>, <span class="number">0xFCBDA653</span>, <span class="number">0x8E902444</span>, <span class="number">0xCA742E12</span>, <span class="number">0xB8424071</span>, <span class="number">0xB4B15EC2</span>, <span class="number">0x943BFA09</span>, <span class="number">0xBC97CD93</span>, <span class="number">1285603712</span>, <span class="number">798920280</span>, <span class="number">0x8B58328F</span>, <span class="number">0xF9822360</span>, <span class="number">0xD1FD15EE</span>, <span class="number">1077514121</span>, <span class="number">1436444106</span>, <span class="number">0xA2D6C17E</span>, <span class="number">1507202797</span>, <span class="number">500756149</span>, <span class="number">198754565</span>, <span class="number">0x8E014807</span>, <span class="number">880454148</span>, <span class="number">1970517398</span>, <span class="number">0xBFC6EE25</span>, <span class="number">1161840191</span>, <span class="number">560498076</span>, <span class="number">1782600856</span>, <span class="number">0x9D93FEBE</span>, <span class="number">1285196205</span>, <span class="number">788797746</span>, <span class="number">1195724574</span>, <span class="number">0xF2174A07</span>, <span class="number">103427523</span>, <span class="number">0x952BFE83</span>, <span class="number">0xF730AC4C</span>, <span class="number">617564657</span>, <span class="number">978211984</span>, <span class="number">1781482121</span>, <span class="number">0x8379D23A</span>, <span class="number">0xEAD737EE</span>, <span class="number">0xE41555FB</span>, <span class="number">659557668</span>, <span class="number">0x99F3B244</span>, <span class="number">1561884856</span>, <span class="number">0x842C31A4</span>, <span class="number">1189296962</span>, <span class="number">169145316</span>, <span class="number">0xA5CE044C</span>, <span class="number">1323893433</span>, <span class="number">824667876</span>, <span class="number">408202876</span>, <span class="number">0xE0178482</span>, <span class="number">0xF412BBBC</span>, <span class="number">1508996065</span>, <span class="number">162419237</span>, <span class="number">0xDE740B00</span>, <span class="number">0xB7CB64FD</span>, <span class="number">0xEBCADB1F</span>, <span class="number">0x8EAE2326</span>, <span class="number">0x933C216C</span>, <span class="number">0xD7D1F649</span>, <span class="number">481927014</span>, <span class="number">0xA448AC16</span>, <span class="number">0xBC082807</span>, <span class="number">1261069441</span>, <span class="number">2063238535</span>, <span class="number">0x8474A61D</span>, <span class="number">101459755</span>, <span class="number">0xBC5654D1</span>, <span class="number">1721190841</span>, <span class="number">1078395785</span>, <span class="number">176506553</span>, <span class="number">0xD3C5280F</span>, <span class="number">1566142515</span>, <span class="number">1938949000</span>, <span class="number">1499289517</span>, <span class="number">0xC59872F8</span>, <span class="number">829714860</span>, <span class="number">0xE51502A2</span>, <span class="number">952932374</span>, <span class="number">1283577465</span>, <span class="number">2045007203</span>, <span class="number">0xEBE6A798</span>, <span class="number">0xE09575CD</span>, <span class="number">0xADDF4157</span>, <span class="number">0xC4770191</span>, <span class="number">482297421</span>, <span class="number">1734231412</span>, <span class="number">0xDAC71054</span>, <span class="number">0x99807E43</span>, <span class="number">0xA88D74B1</span>, <span class="number">0xCB77E028</span>, <span class="number">1533519803</span>, <span class="number">0xEEEBC3B6</span>, <span class="number">0xE7E680E5</span>, <span class="number">272960248</span>, <span class="number">317508587</span>, <span class="number">0xC4B10CDC</span>, <span class="number">0x91776399</span>, <span class="number">27470488</span>, <span class="number">1666674386</span>, <span class="number">1737927609</span>, <span class="number">750987808</span>, <span class="number">0x8E364D8F</span>, <span class="number">0xA0985A77</span>, <span class="number">562925334</span>, <span class="number">0x837D6DC3</span>, <span class="number">0</span> &#125;, k[KEYLEN] = &#123; <span class="number">54</span>, <span class="number">54</span>, <span class="number">54</span>, <span class="number">54</span> &#125;;</span><br><span class="line">	<span class="keyword">int</span> i, index;</span><br><span class="line">	<span class="keyword">int</span> n = <span class="number">155</span>; </span><br><span class="line">	</span><br><span class="line">	btea(v, -n, k);</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> * p = (<span class="keyword">unsigned</span> <span class="keyword">char</span> *)v;</span><br><span class="line">	<span class="keyword">for</span> ( i = <span class="number">0</span>, index = <span class="number">0</span>; index &lt; n; i += <span class="number">4</span>, index++ )</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%c%c%c%c&quot;</span>, p[i + <span class="number">3</span>], p[i + <span class="number">2</span>], p[i + <span class="number">1</span>], p[i]);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;	</span><br><span class="line">&#125; </span><br><span class="line"><span class="comment">//10610336534759505889607399322387179316771488492347274741918862678692508953185876570981227584004676580623553664818853686933004290078153620168054665086468417541382824708104480882577200529822968531743002301934310349005341104696887943182074473298650903541494918266823037984054778903666406545980557074219162536057146090758158128189406073809226361445046225524917089434897957301396534515964547462425719205819342172669899546965221084098690893672595962129879041507903210851706793788311452973769358455761907303633956322972510500253009083922781934406731633755418753858930476576720874219359466503538931371444470303193503733920039 </span></span><br></pre></td></tr></table></figure>

<p>由于e指数过大，拿到密文直接拉去RSA维纳攻击</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">import</span> libnum</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">continuedFra</span>(<span class="params">x, y</span>):</span></span><br><span class="line">    cf = []</span><br><span class="line">    <span class="keyword">while</span> y:</span><br><span class="line">        cf.append(x // y)</span><br><span class="line">        x, y = y, x % y</span><br><span class="line">    <span class="keyword">return</span> cf</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gradualFra</span>(<span class="params">cf</span>):</span></span><br><span class="line">    numerator = <span class="number">0</span></span><br><span class="line">    denominator = <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> cf[::-<span class="number">1</span>]:</span><br><span class="line">        <span class="comment"># 这里的渐进分数分子分母要分开</span></span><br><span class="line">        numerator, denominator = denominator, x * denominator + numerator</span><br><span class="line">    <span class="keyword">return</span> numerator, denominator</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">solve_pq</span>(<span class="params">a, b, c</span>):</span></span><br><span class="line">    par = gmpy2.isqrt(b * b - <span class="number">4</span> * a * c)</span><br><span class="line">    <span class="keyword">return</span> (-b + par) // (<span class="number">2</span> * a), (-b - par) // (<span class="number">2</span> * a)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getGradualFra</span>(<span class="params">cf</span>):</span></span><br><span class="line">    gf = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(cf) + <span class="number">1</span>):</span><br><span class="line">        gf.append(gradualFra(cf[:i]))</span><br><span class="line">    <span class="keyword">return</span> gf</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">wienerAttack</span>(<span class="params">e, n</span>):</span></span><br><span class="line">    cf = continuedFra(e, n)</span><br><span class="line">    gf = getGradualFra(cf)</span><br><span class="line">    <span class="keyword">for</span> d, k <span class="keyword">in</span> gf:</span><br><span class="line">        <span class="keyword">if</span> k == <span class="number">0</span>: <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">if</span> (e * d - <span class="number">1</span>) % k != <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        phi = (e * d - <span class="number">1</span>) // k</span><br><span class="line">        p, q = solve_pq(<span class="number">1</span>, n - phi + <span class="number">1</span>, n)</span><br><span class="line">        <span class="keyword">if</span> p * q == n:</span><br><span class="line">            <span class="keyword">return</span> d</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">n=<span class="number">12702192797044914024075774649965354105344232304099465264316470282606351700311177624703682814557100043599414982439635470829841890299241342602374578366076034128412992290094164613120745611751102797279925764448133764246126488845600641524814194290745105708735258127757986238766868988676022258542038318776640732920027324986285887310132372524224961045858183153047991881042129131551711617627844146600513830709959185824512201669420128585170924683844128155435146399996585220865423125338735154727569986267948480523307784641442521735105741341230032585576300299944879647981670048377150556292280650846158185797588466680532743801893</span></span><br><span class="line">e=<span class="number">12680615221091469696163926483122992106481999501435284497098601343706982733487916553201934931961274845294041438909951977672521864927961654544622905443692482152403380984734291652023321187458458985625147422841102922314725726207365632256563373977251725785357590588556314671253970422319546403985257810950046085994573229162322957630767327089195523762665081311711474689269184996318744510300057603532953644164998953897411177604349567514705039306693117602798453972917348902600111420473965929048876821563646206875034926505783009957256212261250539005023918242209009676914632796839852778318989278092929214021282438144809708279435</span></span><br><span class="line">c=<span class="number">10610336534759505889607399322387179316771488492347274741918862678692508953185876570981227584004676580623553664818853686933004290078153620168054665086468417541382824708104480882577200529822968531743002301934310349005341104696887943182074473298650903541494918266823037984054778903666406545980557074219162536057146090758158128189406073809226361445046225524917089434897957301396534515964547462425719205819342172669899546965221084098690893672595962129879041507903210851706793788311452973769358455761907303633956322972510500253009083922781934406731633755418753858930476576720874219359466503538931371444470303193503733920039</span></span><br><span class="line">d=wienerAttack(e, n)</span><br><span class="line">m=<span class="built_in">pow</span>(c, d, n)</span><br><span class="line"><span class="built_in">print</span>(libnum.n2s(m).decode())</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>GetFlag!</p>
<p><img src="/2022/04/26/DASCTF2022-X-FATE-%E5%A5%87%E6%80%AA%E7%9A%84%E4%BA%A4%E6%98%93/image-20220425233447738.png" alt="image-20220425233447738"></p>
<h1 id="Pyinstaller逆向"><a href="#Pyinstaller逆向" class="headerlink" title="Pyinstaller逆向"></a>Pyinstaller逆向</h1><p>结束了吗，没有！这玄学猜TEA有什么意思！（虽然我也没猜出来</p>
<p>于是看了t0hka师傅的文章发现了这篇好文章</p>
<p><a target="_blank" rel="noopener" href="https://bbs.pediy.com/thread-271253.htm">[原创]Python逆向——Pyinstaller逆向</a></p>
<h2 id="逆向前的思路分析"><a href="#逆向前的思路分析" class="headerlink" title="逆向前的思路分析"></a>逆向前的思路分析</h2><p>首先得大概了解下Pyinstaller这个库到底干了什么，<strong>一句话将py编译成pyc，部分压缩成pyz，程序再对pyc和pyz调用</strong></p>
<p>由于这是3.10的题，所以如果我们想看到import cup里面到底发生了什么，就要先弄个3.10的环境（不然会缺失PYZ-00.pyz_extracted文件夹里的东西）</p>
<p>还是一样解包出这个文件（虽然报了一排错，不过我们要的东西已经拿到了，也就是<strong>PYZ-00.pyz_extracted</strong>文件夹里的东西</p>
<p><img src="/2022/04/26/DASCTF2022-X-FATE-%E5%A5%87%E6%80%AA%E7%9A%84%E4%BA%A4%E6%98%93/image-20220426182709687.png" alt="image-20220426182709687"></p>
<p><strong>关于部分压缩成pyz</strong>，通过pyinstaller库中的archieve文件夹找到pyz_crypto.py文件，<strong>这是对pyz文件的加密代码</strong></p>
<p>加密方法是使用tinyAES库</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Copyright (c) 2005-2021, PyInstaller Development Team.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Distributed under the terms of the GNU General Public License (version 2</span></span><br><span class="line"><span class="comment"># or later) with exception for distributing the bootloader.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The full license is in the file COPYING.txt, distributed with this software.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># SPDX-License-Identifier: (GPL-2.0-or-later WITH Bootloader-exception)</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"> </span><br><span class="line">BLOCK_SIZE = <span class="number">16</span></span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PyiBlockCipher</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    This class is used only to encrypt Python modules.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, key=<span class="literal">None</span></span>):</span></span><br><span class="line">        <span class="keyword">assert</span> <span class="built_in">type</span>(key) <span class="keyword">is</span> <span class="built_in">str</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(key) &gt; BLOCK_SIZE:</span><br><span class="line">            self.key = key[<span class="number">0</span>:BLOCK_SIZE]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.key = key.zfill(BLOCK_SIZE)</span><br><span class="line">        <span class="keyword">assert</span> <span class="built_in">len</span>(self.key) == BLOCK_SIZE</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">import</span> tinyaes</span><br><span class="line">        self._aesmod = tinyaes</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">encrypt</span>(<span class="params">self, data</span>):</span></span><br><span class="line">        iv = os.urandom(BLOCK_SIZE)</span><br><span class="line">        <span class="keyword">return</span> iv + self.__create_cipher(iv).CTR_xcrypt_buffer(data)</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__create_cipher</span>(<span class="params">self, iv</span>):</span></span><br><span class="line">        <span class="comment"># The &#x27;AES&#x27; class is stateful, this factory method is used to</span></span><br><span class="line">        <span class="comment"># re-initialize the block cipher class with each call to xcrypt().</span></span><br><span class="line">        <span class="keyword">return</span> self._aesmod.AES(self.key.encode(), iv)</span><br></pre></td></tr></table></figure>



<h2 id="还原CUP！"><a href="#还原CUP！" class="headerlink" title="还原CUP！"></a>还原CUP！</h2><p>现在我们通过我们解压出文件夹根目录，先找到两个关键文件，一个是密钥一个是加密方法</p>
<p><img src="/2022/04/26/DASCTF2022-X-FATE-%E5%A5%87%E6%80%AA%E7%9A%84%E4%BA%A4%E6%98%93/image-20220426183817755.png" alt="image-20220426183817755"></p>
<p>我们再去PYZ-00.pyz_extracted这个文件夹找到cup.pyc.encrypted</p>
<p><img src="/2022/04/26/DASCTF2022-X-FATE-%E5%A5%87%E6%80%AA%E7%9A%84%E4%BA%A4%E6%98%93/image-20220426183912311.png" alt="image-20220426183912311"></p>
<p>所以现在我们有了</p>
<ol>
<li> 加密方法</li>
<li> 密钥</li>
<li> 要解密的文件</li>
</ol>
<p>引用文章中的代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tinyaes</span><br><span class="line"><span class="keyword">import</span> zlib</span><br><span class="line"> </span><br><span class="line">CRYPT_BLOCK_SIZE = <span class="number">16</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 从crypt_key.pyc获取key，也可自行反编译获取</span></span><br><span class="line">key = <span class="built_in">bytes</span>(<span class="string">&#x27;0000000000000tea&#x27;</span>, <span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"> </span><br><span class="line">inf = <span class="built_in">open</span>(<span class="string">&#x27;cup.pyc.encrypted&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="comment"># 打开加密文件</span></span><br><span class="line">outf = <span class="built_in">open</span>(<span class="string">&#x27;output.pyc&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="comment"># 输出文件</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 按加密块大小进行读取</span></span><br><span class="line">iv = inf.read(CRYPT_BLOCK_SIZE)</span><br><span class="line"> </span><br><span class="line">cipher = tinyaes.AES(key, iv)</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 解密</span></span><br><span class="line">plaintext = zlib.decompress(cipher.CTR_xcrypt_buffer(inf.read()))</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 补pyc头(最后自己补也行)</span></span><br><span class="line">outf.write(<span class="string">b&#x27;\x6f\x0d\x0d\x0a\0\0\0\0\0\0\0\0\0\0\0\0&#x27;</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 写入解密数据</span></span><br><span class="line">outf.write(plaintext)</span><br><span class="line"> </span><br><span class="line">inf.close()</span><br><span class="line">outf.close()</span><br></pre></td></tr></table></figure>

<p>pycdc一把梭或者<a target="_blank" rel="noopener" href="https://tool.lu/pyc/">在线网站</a>都可以，标准的xxtea算法！</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># visit https://tool.lu/pyc/ for more information</span></span><br><span class="line"><span class="keyword">import</span> libnum</span><br><span class="line"><span class="keyword">from</span> ctypes <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">MX</span>(<span class="params">z, y, total, key, p, e</span>):</span></span><br><span class="line">    temp1 = (z.value &gt;&gt; <span class="number">5</span> ^ y.value &lt;&lt; <span class="number">2</span>) + (y.value &gt;&gt; <span class="number">3</span> ^ z.value &lt;&lt; <span class="number">4</span>)</span><br><span class="line">    temp2 = (total.value ^ y.value) + (key[p &amp; <span class="number">3</span> ^ e.value] ^ z.value)</span><br><span class="line">    <span class="keyword">return</span> c_uint32(temp1 ^ temp2)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span>(<span class="params">ᘗ, ᘖ, ᘘ</span>):</span></span><br><span class="line">    ᘜ = <span class="number">0x9E3779B9L</span></span><br><span class="line">    ᘛ = <span class="number">6</span> + <span class="number">52</span> // ᘗ</span><br><span class="line">    total = c_uint32(<span class="number">0</span>)</span><br><span class="line">    ᘔ = c_uint32(ᘖ[ᘗ - <span class="number">1</span>])</span><br><span class="line">    ᘕ = c_uint32(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">if</span> ᘛ &gt; <span class="number">0</span>:</span><br><span class="line">        total.value += ᘜ</span><br><span class="line">        ᘕ.value = total.value &gt;&gt; <span class="number">2</span> &amp; <span class="number">3</span></span><br><span class="line">        ᘚ = c_uint32(ᘖ[<span class="number">0</span>])</span><br><span class="line">        ᘖ[ᘗ - <span class="number">1</span>] = c_uint32(ᘖ[ᘗ - <span class="number">1</span>] + MX(ᘔ, ᘚ, total, ᘘ, ᘗ - <span class="number">1</span>, ᘕ).value).value</span><br><span class="line">        ᘔ.value = ᘖ[ᘗ - <span class="number">1</span>]</span><br><span class="line">        ᘛ -= <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> ᘛ &gt; <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> ᘖ</span><br></pre></td></tr></table></figure>



<h1 id="奇怪的交易-pyc反汇编扩展"><a href="#奇怪的交易-pyc反汇编扩展" class="headerlink" title="奇怪的交易.pyc反汇编扩展"></a>奇怪的交易.pyc反汇编扩展</h1><p>手淦汇编扩展，emmm淦了很久汇编，看到反汇编感觉翻译错了，但单看源码应该没什么问题，也许加了什么花，对于那些奇怪的跳转其实也许是while</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> libnum</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">TEA</span>():</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;DAS&quot;</span>)</span><br><span class="line"></span><br><span class="line">flag = <span class="built_in">input</span>()</span><br><span class="line">pub_key = [<span class="number">0x649EE967E7916A825CC9FD3320BEABF263BEAC68C080F52824A0F521EDB6B78577EC52BF1C9E78F4BB71192F9A23F1A17AA76E5979E4D953329D3CA65FB4A71DA57412B59DFD6AEDF0191C5555D3E5F582B81B5E6B23163E9889204A81AFFDF119FE25C92F4ED59BD3285BCD7AAE14824240D2E33C5A97848F4EB7AAC203DE6330D2B4D8FF61691544FBECD120F99A157B3D2F58FA51B2887A9D06CA383C44D071314A12B17928B96F03A06E959A5AFEFA0183664F52CD32B9FC72A04B45913FCB2D5D2D3A415A14F611CF1EAC2D6C785142A8E9CC41B67A6CD85001B06EDB8CA767D367E56E0AE651491BF8A8C17A38A1835DB9E4A9292B1D86D5776C98CC25</span>, <span class="number">0x647327833ACFEF1F9C83E74E171FC300FA347D4A6769476C33DA82C95120ACB38B62B33D429206FE6E9BB0BB7AB748A1036971BEA36EC47130B749C1C9FF6FE03D0F7D9FC5346EB0E575BDFA6C530AA57CD676894FC080D2DD049AB59625F4B9C78BCFD95CDCD2793E440E26E189D251121CB6EB177FEDB596409034E8B0C5BBD9BD9342235DBB226C9170EFE347FF0FD2CFF9A1F7B647CC83E4D8F005FD7125A89251C768AFE70BDD54B88116814D5030F499BCAC4673CCCC342FB4B6AC58EA5A64546DC25912B6C430529F6A7F449FD96536DE269D1A1B015A4AC6B6E46EE19DCE8143726A6503E290E4BAE6BD78319B5878981F6CFFDB3B818209341FD68B</span>]</span><br><span class="line">m = libnum.s2n(flag)</span><br><span class="line"></span><br><span class="line">c = <span class="built_in">str</span>(<span class="built_in">pow</span>(m, pub_key[<span class="number">1</span>], pub_key[<span class="number">0</span>]))</span><br><span class="line">list_input = []</span><br><span class="line">list_enc = [<span class="number">0xD28ED952</span>, <span class="number">1472742623</span>, <span class="number">0xD91BA938</span>, <span class="number">0xF9F3BD2D</span>, <span class="number">0x8EF8E43D</span>, <span class="number">617653972</span>, <span class="number">1474514999</span>, <span class="number">1471783658</span>, <span class="number">1012864704</span>, <span class="number">0xD7821910</span>, <span class="number">993855884</span>, <span class="number">438456717</span>, <span class="number">0xC83555B7</span>, <span class="number">0xE8DFF468</span>, <span class="number">198959101</span>, <span class="number">0xC5B84FEB</span>, <span class="number">0xD9F837C6</span>, <span class="number">613157871</span>, <span class="number">0x8EFA4EDD</span>, <span class="number">97286225</span>, <span class="number">0x8B4B608C</span>, <span class="number">1471645170</span>, <span class="number">0xC0B62792</span>, <span class="number">583597118</span>, <span class="number">0xAAB1C22D</span>, <span class="number">0xBDB9C266</span>, <span class="number">1384330715</span>, <span class="number">0xAE9F9816</span>, <span class="number">0xD1F40B3C</span>, <span class="number">0x8206DDC3</span>, <span class="number">0xC4E0BADC</span>, <span class="number">0xE407BD26</span>, <span class="number">145643141</span>, <span class="number">0x8016C6A5</span>, <span class="number">0xAF4AB9D3</span>, <span class="number">506798154</span>, <span class="number">994590281</span>, <span class="number">0x85082A0B</span>, <span class="number">0xCA0BC95A</span>, <span class="number">0xA7BE567C</span>, <span class="number">1105937096</span>, <span class="number">1789727804</span>, <span class="number">0xDFEFB591</span>, <span class="number">0x93346B38</span>, <span class="number">1162286478</span>, <span class="number">680814033</span>, <span class="number">0xAEE1A7A2</span>, <span class="number">0x80E574AE</span>, <span class="number">0xF154F55F</span>, <span class="number">2121620700</span>, <span class="number">0xFCBDA653</span>, <span class="number">0x8E902444</span>, <span class="number">0xCA742E12</span>, <span class="number">0xB8424071</span>, <span class="number">0xB4B15EC2</span>, <span class="number">0x943BFA09</span>, <span class="number">0xBC97CD93</span>, <span class="number">1285603712</span>, <span class="number">798920280</span>, <span class="number">0x8B58328F</span>, <span class="number">0xF9822360</span>, <span class="number">0xD1FD15EE</span>, <span class="number">1077514121</span>, <span class="number">1436444106</span>, <span class="number">0xA2D6C17E</span>, <span class="number">1507202797</span>, <span class="number">500756149</span>, <span class="number">198754565</span>, <span class="number">0x8E014807</span>, <span class="number">880454148</span>, <span class="number">1970517398</span>, <span class="number">0xBFC6EE25</span>, <span class="number">1161840191</span>, <span class="number">560498076</span>, <span class="number">1782600856</span>, <span class="number">0x9D93FEBE</span>, <span class="number">1285196205</span>, <span class="number">788797746</span>, <span class="number">1195724574</span>, <span class="number">0xF2174A07</span>, <span class="number">103427523</span>, <span class="number">0x952BFE83</span>, <span class="number">0xF730AC4C</span>, <span class="number">617564657</span>, <span class="number">978211984</span>, <span class="number">1781482121</span>, <span class="number">0x8379D23A</span>, <span class="number">0xEAD737EE</span>, <span class="number">0xE41555FB</span>, <span class="number">659557668</span>, <span class="number">0x99F3B244</span>, <span class="number">1561884856</span>, <span class="number">0x842C31A4</span>, <span class="number">1189296962</span>, <span class="number">169145316</span>, <span class="number">0xA5CE044C</span>, <span class="number">1323893433</span>, <span class="number">824667876</span>, <span class="number">408202876</span>, <span class="number">0xE0178482</span>, <span class="number">0xF412BBBC</span>, <span class="number">1508996065</span>, <span class="number">162419237</span>, <span class="number">0xDE740B00</span>, <span class="number">0xB7CB64FD</span>, <span class="number">0xEBCADB1F</span>, <span class="number">0x8EAE2326</span>, <span class="number">0x933C216C</span>, <span class="number">0xD7D1F649</span>, <span class="number">481927014</span>, <span class="number">0xA448AC16</span>, <span class="number">0xBC082807</span>, <span class="number">1261069441</span>, <span class="number">2063238535</span>, <span class="number">0x8474A61D</span>, <span class="number">101459755</span>, <span class="number">0xBC5654D1</span>, <span class="number">1721190841</span>, <span class="number">1078395785</span>, <span class="number">176506553</span>, <span class="number">0xD3C5280F</span>, <span class="number">1566142515</span>, <span class="number">1938949000</span>, <span class="number">1499289517</span>, <span class="number">0xC59872F8</span>, <span class="number">829714860</span>, <span class="number">0xE51502A2</span>, <span class="number">952932374</span>, <span class="number">1283577465</span>, <span class="number">2045007203</span>, <span class="number">0xEBE6A798</span>, <span class="number">0xE09575CD</span>, <span class="number">0xADDF4157</span>, <span class="number">0xC4770191</span>, <span class="number">482297421</span>, <span class="number">1734231412</span>, <span class="number">0xDAC71054</span>, <span class="number">0x99807E43</span>, <span class="number">0xA88D74B1</span>, <span class="number">0xCB77E028</span>, <span class="number">1533519803</span>, <span class="number">0xEEEBC3B6</span>, <span class="number">0xE7E680E5</span>, <span class="number">272960248</span>, <span class="number">317508587</span>, <span class="number">0xC4B10CDC</span>, <span class="number">0x91776399</span>, <span class="number">27470488</span>, <span class="number">1666674386</span>, <span class="number">1737927609</span>, <span class="number">750987808</span>, <span class="number">0x8E364D8F</span>, <span class="number">0xA0985A77</span>, <span class="number">562925334</span>, <span class="number">0x837D6DC3</span>]</span><br><span class="line"></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> i &lt; <span class="built_in">len</span>(c):</span><br><span class="line">    t = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> ii <span class="keyword">in</span> c[i: i + <span class="number">4</span>]:     </span><br><span class="line">        t = (t &lt;&lt; <span class="number">8</span>) + <span class="built_in">ord</span>(ii)  </span><br><span class="line">    list_input.append(t)    </span><br><span class="line">    i += <span class="number">4</span>   </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> i &lt; <span class="built_in">len</span>(c):</span><br><span class="line">        list_data = [<span class="number">54</span>, <span class="number">54</span>, <span class="number">54</span>, <span class="number">54</span>]</span><br><span class="line">        len_input = <span class="built_in">len</span>(list_input)</span><br><span class="line">        res = XXTEA(list_data, list_input, len_input)</span><br><span class="line">        <span class="keyword">if</span> list_input == list_enc:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;P.Z!!&quot;</span>)</span><br></pre></td></tr></table></figure>


    </div>
    
    <div id = "frozen-btn" class = "center">
    <!-- <button class="green" onclick = "Change()">🎉☕一杯咖啡~</button> -->
    <button class="purple" onclick = "Change()">🍰</button>
    </div>
    
    <div class = "hide" id = "img">
        <div class="post-list">
            <article class="post-list-item">
                <div class="content">
                    <img src="/img/Coffee/AliPay.png" alt="DASCTF X SU">
                    <div class="center">
                        🍬
                    </div>
                </div>
            </article>
            <article class="post-list-item">
                <div class="content">
                    <img src="/img/Coffee/WeChat.png" alt="HFCTF2022">
                    <div class="center">
                        🍪
                    </div>
                </div>
            </article>
        </div>
    </div>
    <script>
            function Change()
            {
                var img = document.getElementById("img");
                if(img.className == "hide")
                {
                    img.className="";
                }
                else
                {
                    img.className="hide";
                }
            }
    </script>

    <div class="about">
        <h1>About this Post</h1>
        <p>This post is written by P.Z, licensed under <a
                target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc/4.0">CC BY-NC 4.0</a>.</p>
    </div>
    <!-- 
        
     -->
<div class="container">
<!-- <div id="waline"></div>
  <script>
    Waline({
      el: '#waline',
      serverURL: 'https://blog-api-pozeep.vercel.app/',  
      visitor: true,
      emoji: [   //这里加了一些表情 
        'https://cdn.jsdelivr.net/gh/walinejs/emojis@1.0.0/weibo',
        'https://cdn.jsdelivr.net/gh/walinejs/emojis@1.0.0/bilibili',
        'https://cdn.jsdelivr.net/gh/walinejs/emojis@1.0.0/qq',
        'https://cdn.jsdelivr.net/gh/walinejs/emojis@1.0.0/tieba',
      ],
       avatar: 'robohash',   //自定义默认头像为随机的机器人
       placeholder: '🍟🍰🧊🍔🍓🍫🍦🍗🍇🍉🍑🥐🍕',   //占位符
    });
  </script>
</div> -->

<!-- <span id="/2022/04/26/DASCTF2022-X-FATE-奇怪的交易/" class="leancloud_visitors" data-flag-title="DASCTF2022 X FATE-奇怪的交易">
    <em class="post-meta-item-text">阅读量 </em>
    <i class="waline-visitor-count"></i>
</span> -->

</article>
        <footer>
    <div class="inner">
        <div class="links">
            
            <div class="group">
                <h4 class="title">Blog</h4>
                
                <a href="/" class="item">Home</a>
                
                <a href="/Diary/Diary.html" class="item">Diary</a>
                
                <a href="/Friends/Friends.html" class="item">Friends</a>
                
                <a href="/CTF/CTF.html" class="item">CTF</a>
                
                <a href="/Book/Book.html" class="item">Book</a>
                
            </div>
            
            <div class="group">
                <h4 class="title">Me</h4>
                
                <a target="_blank" rel="noopener" href="https://github.com/PoZeep" class="item">GitHub</a>
                
                <a target="_blank" rel="noopener" href="https://space.bilibili.com/39892350" class="item">BiliBili</a>
                
            </div>
            
        </div>
        <span>&copy; 2025 P.Z<br >Powered by <a href="http://hexo.io/" target="_blank">Hexo</a></span>
        
            <br>
            <div class="color-scheme-toggle" role="radiogroup" id="theme-color-scheme-toggle">
                <label>
                    <input type="radio" value="light">
                    <span>Light</span>
                </label>
                <label>
                    <input type="radio" value="dark">
                    <span>Dark</span>
                </label>
                <label>
                    <input type="radio" value="auto">
                    <span>Auto</span>
                </label>
            </div>
        
        
    <span id="sitetime" style="text-align: center;display:block;"></span>


</footer>

<script language=javascript>
    function siteTime() {
        window.setTimeout("siteTime()", 1000);
        var seconds = 1000;
        var minutes = seconds * 60;
        var hours = minutes * 60;
        var days = hours * 24;
        var years = days * 365;
        var today = new Date();
        var todayYear = today.getFullYear();
        var todayMonth = today.getMonth() + 1;
        var todayDate = today.getDate();
        var todayHour = today.getHours();
        var todayMinute = today.getMinutes();
        var todaySecond = today.getSeconds();
        /* Date.UTC() -- 返回date对象距世界标准时间(UTC)1970年1月1日午夜之间的毫秒数(时间戳)
        year - 作为date对象的年份，为4位年份值
        month - 0-11之间的整数，做为date对象的月份
        day - 1-31之间的整数，做为date对象的天数
        hours - 0(午夜24点)-23之间的整数，做为date对象的小时数
        minutes - 0-59之间的整数，做为date对象的分钟数
        seconds - 0-59之间的整数，做为date对象的秒数
        microseconds - 0-999之间的整数，做为date对象的毫秒数 */
        var t1 = Date.UTC(2021, 12, 27, 12, 00, 00); //北京时间2018-2-13 00:00:00
        var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
        var diff = t2 - t1;
        var diffYears = Math.floor(diff / years);
        var diffDays = Math.floor((diff / days) - diffYears * 365);
        var diffHours = Math.floor((diff - (diffYears * 365 + diffDays) * days) / hours);
        var diffMinutes = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours) / minutes);
        var diffSeconds = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours - diffMinutes * minutes) / seconds);
        document.getElementById("sitetime").innerHTML = "我已运行 " +diffYears+" 年 "+diffDays + " 天 " + diffHours + " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
    }/*因为建站时间还没有一年，就将之注释掉了*/
    siteTime();
</script>

<!-- 在线通讯Tidio -->

<script src="//code.tidio.co/zmdcv08a6racnaer2so7xybdwby41fsa.js"></script>



        
<script src="/js/main.js"></script>

        
    </body>
</html>