<!DOCTYPE html>
<html lang="en">
    <!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1">
  <meta name="color-scheme" content="light dark">
  
  <title>存储器大Boss - P.Z&#39;s Blog</title>
  
    <link rel="shortcut icon" href="/favicon.png">
  
  

  
<link rel="stylesheet" href="/css/var.css">

  
<link rel="stylesheet" href="/css/main.css">

  
<link rel="stylesheet" href="/css/typography.css">

  
<link rel="stylesheet" href="/css/code-highlighting.css">

  
<link rel="stylesheet" href="/css/components.css">

  
<link rel="stylesheet" href="/css/nav.css">

  
<link rel="stylesheet" href="/css/paginator.css">

  
<link rel="stylesheet" href="/css/footer.css">

  
<link rel="stylesheet" href="/css/post-list.css">

  
<link rel="stylesheet" href="/css/waline.css">

  
  
  
<link rel="stylesheet" href="/css/post.css">

  

  
    
<script src="https://cdn.jsdelivr.net/npm/js-cookie@rc/dist/js.cookie.min.js"></script>
 
  

    <script src='//cdn.jsdelivr.net/npm/@waline/client/dist/Waline.min.js'></script>

<meta name="generator" content="Hexo 6.0.0"></head>

<!-- //unpkg.com/@waline/client -->
<!--  -->
    <body data-color-scheme="auto">
        <nav id="theme-nav">
    <div class="inner">
        <a class="title" href="/">P.Z&#39;s Blog</a>
        <div class="nav-arrow"></div>
        <div class="nav-items">
            <a class="nav-item nav-item-home" href="/">Home</a>
            
            
            <a class="nav-item" href="/Friends/Friends">Friends</a>
            
            
            
            <a class="nav-item" href="/About/About">About</a>
            
            
            
            <a class="nav-item nav-item-github nav-item-icon" href="https://github.com/PoZeep" target="_blank">&nbsp;</a>
            
            
            
            <a class="nav-item nav-item-patreon nav-item-icon" href="https://space.bilibili.com/39892350" target="_blank">&nbsp;</a>
            
            
        </div>
    </div>
</nav>
        <article class="post">
    <div class="meta">
        
        <div class="date" id="date">
            
            
            
            
            
            <span>May</span>
            
            
            
            
            
            
            
            
            <span>7,</span>
            <span>2024</span>
        </div>
        

        <h2 class="title">存储器大Boss</h2>
    </div>

    <div class="divider"></div>

    <div class="content">
        <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>当初拿到这份讲义，翻到最后看到这题两眼一黑，如今终于可以面对，说实话这道大题超级综合，各种知识点的设计，包括计组的题目说实话每一句话都是知识点，给我们上课的M佬说实话真的不错，每听一遍课都有新的感悟</p>
<p>还以为考研期间没机会写文章了，然而这道大题完全值得一篇文章来精析</p>
<h1 id="存储器大Boss"><a href="#存储器大Boss" class="headerlink" title="存储器大Boss"></a>存储器大Boss</h1><p><img src="/2024/05/07/%E5%AD%98%E5%82%A8%E5%99%A8%E5%A4%A7Boss/image-20240507211545643.png" alt="image-20240507211545643"></p>
<h4 id="1-主考点：刷新周期与存储周期-amp-刷新计数器位数"><a href="#1-主考点：刷新周期与存储周期-amp-刷新计数器位数" class="headerlink" title="1. 主考点：刷新周期与存储周期 &amp; 刷新计数器位数"></a>1. 主考点：刷新周期与存储周期 &amp; 刷新计数器位数</h4><p><img src="/2024/05/07/%E5%AD%98%E5%82%A8%E5%99%A8%E5%A4%A7Boss/image-20240507220732564.png" alt="image-20240507220732564"></p>
<p><strong>由于 8 块 DRAM 组成 2GB 内存条，可得每个 DRAM 容量为 256 MB（2^28）</strong></p>
<p>=&gt; DRAM 芯片每个 2^14 行 2^14 列，即 16384 行 16384 列</p>
<p>再有异步刷新，且题目给出刷新周期为 10.485760ms，由王道P68页可知 <strong>两行之间刷新间隔为刷新周期除行数</strong></p>
<p>=&gt; 10.485760  / 16384 = 640ns</p>
<ul>
<li>题目第一问是时间间隔多少个存储周期？那么我们再除存储周期40ns就可得间隔多少个存储周期</li>
</ul>
<p>=&gt; 640 / 40 = 16个存储周期</p>
<p><strong>求间隔存储周期总结</strong></p>
<ol>
<li>求DRAM行数</li>
<li>算出两行间隔时间</li>
<li>题目要求有多少个存储周期，那么再除题目给出的存储周期即可</li>
</ol>
<ul>
<li>题目第二问 DRAM 中刷新计数器多少位？刷新计数器是为了记录cache行刷新</li>
</ul>
<p>=&gt; <strong>刷新计数器即为行的位数也就是 14 位</strong></p>
<h4 id="2-主考点：行缓冲容量计算-amp-地址引脚复用"><a href="#2-主考点：行缓冲容量计算-amp-地址引脚复用" class="headerlink" title="2. 主考点：行缓冲容量计算 &amp; 地址引脚复用"></a>2. 主考点：行缓冲容量计算 &amp; 地址引脚复用</h4><p><img src="/2024/05/07/%E5%AD%98%E5%82%A8%E5%99%A8%E5%A4%A7Boss/image-20240507213029073.png" alt="image-20240507213029073"></p>
<ul>
<li>如第一解可知 DRAM 中每行有 16384 个存储单元，每个存储单元 1 字节</li>
</ul>
<p>=&gt; <strong>行缓存寄存器大小为 16384 字节</strong></p>
<ul>
<li>再由第一解可知每个DRAM芯片256MB，也就是 2^28，而<strong>地址引脚复用技术</strong>，行地址和列地址通过相通引脚分先后两次输入（王道书P89）</li>
</ul>
<p>=&gt; DRAM芯片的地址引脚个数为14个</p>
<h4 id="3-主考点：主存与Cache的地址结构"><a href="#3-主考点：主存与Cache的地址结构" class="headerlink" title="3. 主考点：主存与Cache的地址结构"></a>3. 主考点：主存与Cache的地址结构</h4><p><img src="/2024/05/07/%E5%AD%98%E5%82%A8%E5%99%A8%E5%A4%A7Boss/image-20240507213923172.png" alt="image-20240507213923172"></p>
<p><strong>算Cache前我觉得都理清一下基础信息：Cache行大小、Cache行数、Cache组号、主存地址结构</strong></p>
<ol>
<li>Cache行的大小题干给出是64bit，那么就是8byte</li>
<li>由Cache数据区有512B且一行8byte，可知 512 / 8 = 64 行</li>
<li>由于4路组相连，可知 64 / 4 = 16 组</li>
<li>由于题目是组相连映射，且知组相连映射的地址结构为 TAG + 组号（4bit） + 块内映射（3bit）</li>
</ol>
<p>16组 =&gt; 4bit组号，8byte大小 =&gt; 3bit块内映射，<strong>由于内存条为2GB，所以主存位数31位</strong>（自己做错的地方）</p>
<p>TAG = 31 - 4 - 3 = 24bit</p>
<p><img src="/2024/05/07/%E5%AD%98%E5%82%A8%E5%99%A8%E5%A4%A7Boss/image-20240507221915895.png" alt="image-20240507221915895"></p>
<ul>
<li>第二问求多少个比较器，因为是四路组相连</li>
</ul>
<p>所以可以直接得知4个比较器</p>
<ul>
<li>第一问求数据Cache总容量，数据Cache总容量 = 标记阵列 + 数据阵列（题干已给出为512B）</li>
</ul>
<p>主要就是在标记阵列的求法了，<strong>标记阵列 = 有效位 + 脏位 + 算法替换位 + TAG</strong></p>
<ol>
<li>有效位</li>
</ol>
<p>所有Cache行都会有一个有效位，所以这里 1bit</p>
<ol start="2">
<li>脏位</li>
</ol>
<p>由题干可知采用了回写策略，所以脏位 1bit</p>
<ol start="3">
<li>算法替换位</li>
</ol>
<p>由于是4路组相连，该计数器的位数与Cache组大小有关，所以为 2bit</p>
<ol start="4">
<li>TAG</li>
</ol>
<p><strong>Cache的TAG，由主存地址结构的TAG推出，24bit</strong></p>
<p>综上，数据 Cache 的标记矩阵为 (24 + 2 + 1 + 1) * 64 = 1792bit，也就是64行Cache行的总标记阵列，而数据阵列为512byte也就是4096bit，于是数据Cache总容量大小为 4096 + 1792 = 5888bit</p>
<h4 id="4-主考点：CPU访问Cache-amp-突发传送-amp-轮流启动"><a href="#4-主考点：CPU访问Cache-amp-突发传送-amp-轮流启动" class="headerlink" title="4. 主考点：CPU访问Cache &amp; 突发传送 &amp; 轮流启动"></a>4. 主考点：CPU访问Cache &amp; 突发传送 &amp; 轮流启动</h4><p><img src="/2024/05/07/%E5%AD%98%E5%82%A8%E5%99%A8%E5%A4%A7Boss/image-20240508103516664.png" alt="image-20240508103516664"></p>
<p>请问CPU读取指令A和指令B所需要的时间为多少？（指令Cache中，0-3组的标 记字段的内容如下图(仅包含有效位和标记)）</p>
<p><img src="/2024/05/07/%E5%AD%98%E5%82%A8%E5%99%A8%E5%A4%A7Boss/image-20240508103713291.png" alt="image-20240508103713291"></p>
<ul>
<li>第一问：CPU读取指令A（地址：6123458DH）所需时间</li>
</ul>
<p>这里是卡我的第一个点，首先看这个地址要以更高的一个维度，整理一下知识点，当我们有了主存地址，对应不同的情况有不同的理解角度，考研计组中有三种方式</p>
<p><strong>注意主存地址要根据不同映射方式解析为不同的地址结构，而该题组相连映射都是如此，也不要和Cache内的标记阵列弄混</strong></p>
<p><img src="/2024/05/07/%E5%AD%98%E5%82%A8%E5%99%A8%E5%A4%A7Boss/image-20240507221915895.png" alt="image-20240507221915895"></p>
<ol>
<li>考察地址到Cache映射的时候，解析方式为 TAG + 组号 + 块内偏移<ul>
<li>通过组号找到对应组，再通过TAG进行标记找到目标Cache行，而块内偏移就是为了找到Cache行的某个字节</li>
</ul>
</li>
<li>考察DRAM芯片交叉编址，解析方式是 芯片地址 + 组号</li>
<li>考虚拟存储系统，解析方式为 页号 + 页内地址</li>
</ol>
<p>该问CPU读取时间显然是让我们模拟读取过程并计算，如图</p>
<p><img src="/2024/05/07/%E5%AD%98%E5%82%A8%E5%99%A8%E5%A4%A7Boss/image-20240508111404661.png" alt="image-20240508111404661"></p>
<p>先访问Cache，也就是我刚刚总结的第一种情况，6123458DH先全部转为二进制，高24位为0C2468B，低7位（前四位是0001）</p>
<ul>
<li>于是在0001组也就是题目给出的前四个Cache组的第二列</li>
<li>再通过TAG比对，发现有效位为1，Cache命中</li>
</ul>
<p>题干给出CPU主频为1GHz =&gt; <strong>主频的倒数即为时钟周期</strong>，那么1GHz倒数即为 1ns</p>
<p>题干给出Cache命中的<strong>CPI（一条指令所要的时钟周期）</strong>为5</p>
<p>=&gt; CPU读取指令A所要的时钟周期为 5 x 1 = 5ns</p>
<ul>
<li>第二问：CPU读取指令B（地址：6841301BH）所需时间</li>
</ul>
<p>同样先访问Cache，6123458DH先全部转为二进制，高24位为0D08260H，低7位（前四位是0011），于是在0011组有对应TAG，但有效位为0，未命中</p>
<p>由题干可知</p>
<blockquote>
<p><strong>当出现CacheMiss时，总线采用突发传送总线事务从主存向Cache传输主存块。每次读突发传送总线事务的过程包括：送首地址和命令，DRAM芯片准备数据，传送数据。每次突发传送8B，传送地址或1B数据的时间需要5ns</strong></p>
</blockquote>
<p>总结一下突发传送总线数据</p>
<ol>
<li>CPU给主存传地址</li>
<li>连续传送主存块的存储单元</li>
</ol>
<p>（PPT上讲的突发传送是送地址和存储点单元，这只是一般情况，具体题目具体情况分析）</p>
<p><strong>这里也有一个需要注意的地方，题干中也给出数据线个数为8根，也就是8bit，而主存块个数为64bit(8byte)，而同时启动要求是数据根数必须和主存块位数一样，所以不考虑同时启动，该题就是轮流启动</strong></p>
<p>那么如图，由于未命中，所以从CPU传地址到主存，读取DRAM芯片，再到主存存入Cache的轮流启动过程</p>
<p><img src="/2024/05/07/%E5%AD%98%E5%82%A8%E5%99%A8%E5%A4%A7Boss/image-20240508120000855.png" alt="image-20240508120000855"></p>
<p>最后CPU读取指令B，也就是当前已经从主存取来的数据由题干可知只要5ns</p>
<p>=&gt; 5 + 85 = 90ns（用5ns访问Cache，85ns完成突发传送）</p>
<h4 id="5-主考点：Cache存入机制"><a href="#5-主考点：Cache存入机制" class="headerlink" title="5. 主考点：Cache存入机制"></a>5. 主考点：Cache存入机制</h4><p><img src="/2024/05/07/%E5%AD%98%E5%82%A8%E5%99%A8%E5%A4%A7Boss/image-20240508120108160.png" alt="image-20240508120108160"></p>
<p>主存块大小为8B，一个int类型数据为4B，一个主存块可以包含2个int类型数据</p>
<p>=&gt; 数组A存放在 128 / 2 = 64 个主存块中</p>
<p>题干中可知</p>
<blockquote>
<p>开始时，数据Cache均为空。</p>
</blockquote>
<p>所以当读取A[0]时候，Cache miss，用时90ns才能读到，而读A[1]时，这个时候该数据已经在Cache中，所以只要5ns读入</p>
<p>=&gt; 也就说一个主存块中的两个int类型数据需要的总时间就是 90ns + 5ns = 95ns</p>
<p>于是可知，访问64个主存块中存储的 128 个int类型数据总时间为 95 * 64 = 6080ns</p>
<h1 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h1><p>终于写完了…差不多写了三个多小时？？昨天下午光理解就花了好久，但感觉也非常值得，这次复盘把很多知识点都理了一遍，可以说是基础轮存储器大复盘的一个收尾，之后再遇到类似的题目就不怕了，这么huge的一个题目解决了，其他题目再多也不会多于此了。 – 2024.5.8 12:11</p>
<p><img src="/2024/05/07/%E5%AD%98%E5%82%A8%E5%99%A8%E5%A4%A7Boss/image-20240508122108730.png" alt="image-20240508122108730"></p>

    </div>
    
    <div id = "frozen-btn" class = "center">
    <!-- <button class="green" onclick = "Change()">🎉☕一杯咖啡~</button> -->
    <button class="purple" onclick = "Change()">🍰</button>
    </div>
    
    <!-- <div class = "hide" id = "img">
        <div class="post-list">
            <article class="post-list-item">
                <div class="content">
                    <img src="/img/Coffee/AliPay.png" alt="DASCTF X SU">
                    <div class="center">
                        🍬
                    </div>
                </div>
            </article>
            <article class="post-list-item">
                <div class="content">
                    <img src="/img/Coffee/WeChat.png" alt="HFCTF2022">
                    <div class="center">
                        🍪
                    </div>
                </div>
            </article>
        </div>
    </div> -->
    <script>
            function Change()
            {
                var img = document.getElementById("img");
                if(img.className == "hide")
                {
                    img.className="";
                }
                else
                {
                    img.className="hide";
                }
            }
    </script>

    <div class="about">
        <h1>About this Post</h1>
        <p>This post is written by P.Z, licensed under <a
                target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc/4.0">CC BY-NC 4.0</a>.</p>
    </div>
    <!-- 
        
     -->
<div class="container">
<!-- <div id="waline"></div>
  <script>
    Waline({
      el: '#waline',
      serverURL: 'https://blog-api-pozeep.vercel.app/',  
      visitor: true,
      emoji: [   //这里加了一些表情 
        'https://cdn.jsdelivr.net/gh/walinejs/emojis@1.0.0/weibo',
        'https://cdn.jsdelivr.net/gh/walinejs/emojis@1.0.0/bilibili',
        'https://cdn.jsdelivr.net/gh/walinejs/emojis@1.0.0/qq',
        'https://cdn.jsdelivr.net/gh/walinejs/emojis@1.0.0/tieba',
      ],
       avatar: 'robohash',   //自定义默认头像为随机的机器人
       placeholder: '🍟🍰🧊🍔🍓🍫🍦🍗🍇🍉🍑🥐🍕',   //占位符
    });
  </script>
</div> -->

<!-- <span id="/2024/05/07/存储器大Boss/" class="leancloud_visitors" data-flag-title="存储器大Boss">
    <em class="post-meta-item-text">阅读量 </em>
    <i class="waline-visitor-count"></i>
</span> -->

</article>
        <footer>
    <div class="inner">
        <div class="links">
            
            <div class="group">
                <h4 class="title">Blog</h4>
                
                <a href="/" class="item">Home</a>
                
                <a href="/Friends/Friends" class="item">Friends</a>
                
                <a href="/About/About" class="item">About</a>
                
            </div>
            
            <div class="group">
                <h4 class="title">Me</h4>
                
                <a target="_blank" rel="noopener" href="https://github.com/PoZeep" class="item">GitHub</a>
                
                <a target="_blank" rel="noopener" href="https://space.bilibili.com/39892350" class="item">BiliBili</a>
                
            </div>
            
        </div>
        <span>&copy; 2026 P.Z<br >Powered by <a href="http://hexo.io/" target="_blank">Hexo</a></span>
        
            <br>
            <div class="color-scheme-toggle" role="radiogroup" id="theme-color-scheme-toggle">
                <label>
                    <input type="radio" value="light">
                    <span>Light</span>
                </label>
                <label>
                    <input type="radio" value="dark">
                    <span>Dark</span>
                </label>
                <label>
                    <input type="radio" value="auto">
                    <span>Auto</span>
                </label>
            </div>
        
        
    <span id="sitetime" style="text-align: center;display:block;"></span>


</footer>

<script language=javascript>
    function siteTime() {
        window.setTimeout("siteTime()", 1000);
        var seconds = 1000;
        var minutes = seconds * 60;
        var hours = minutes * 60;
        var days = hours * 24;
        var years = days * 365;
        var today = new Date();
        var todayYear = today.getFullYear();
        var todayMonth = today.getMonth() + 1;
        var todayDate = today.getDate();
        var todayHour = today.getHours();
        var todayMinute = today.getMinutes();
        var todaySecond = today.getSeconds();
        /* Date.UTC() -- 返回date对象距世界标准时间(UTC)1970年1月1日午夜之间的毫秒数(时间戳)
        year - 作为date对象的年份，为4位年份值
        month - 0-11之间的整数，做为date对象的月份
        day - 1-31之间的整数，做为date对象的天数
        hours - 0(午夜24点)-23之间的整数，做为date对象的小时数
        minutes - 0-59之间的整数，做为date对象的分钟数
        seconds - 0-59之间的整数，做为date对象的秒数
        microseconds - 0-999之间的整数，做为date对象的毫秒数 */
        var t1 = Date.UTC(2021, 12, 27, 12, 00, 00); //北京时间2018-2-13 00:00:00
        var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
        var diff = t2 - t1;
        var diffYears = Math.floor(diff / years);
        var diffDays = Math.floor((diff / days) - diffYears * 365);
        var diffHours = Math.floor((diff - (diffYears * 365 + diffDays) * days) / hours);
        var diffMinutes = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours) / minutes);
        var diffSeconds = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours - diffMinutes * minutes) / seconds);
        document.getElementById("sitetime").innerHTML = "我已运行 " +diffYears+" 年 "+diffDays + " 天 " + diffHours + " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
    }/*因为建站时间还没有一年，就将之注释掉了*/
    siteTime();
</script>

<!-- 在线通讯Tidio -->

<script src="//code.tidio.co/zmdcv08a6racnaer2so7xybdwby41fsa.js"></script>



        
<script src="/js/main.js"></script>

        
    </body>
</html>